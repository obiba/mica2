/*!
 * ng-obiba-mica - v1.0.0
 * https://github.com/obiba/ng-obiba-mica

 * License: GNU Public License version 3
 * Date: 2015-11-26
 */
/*
 * Copyright (c) 2014 OBiBa. All rights reserved.
 *
 * This program and the accompanying materials
 * are made available under the terms of the GNU Public License v3.0.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
"use strict";angular.module("dataAccessRequest",["pascalprecht.translate","obiba.alert","obiba.comments","angularMoment","templates-ngObibaMica"]),angular.module("dataAccessRequest").controller("DataAccessRequestListController",["$rootScope","$scope","DataAccessRequestsResource","DataAccessRequestResource","DataAccessRequestService","NOTIFICATION_EVENTS","Session","USER_ROLES",function(a,b,c,d,e,f,g,h){console.log(">>>><<<<>>>><<<<");var i=function(a){for(var c=0;c<a.length;c++){var d=a[c];if("OPENED"!==d.status)for(var e=0;e<d.statusChangeHistory.length;e++){var f=d.statusChangeHistory[e];"OPENED"===f.from&&"SUBMITTED"===f.to&&(d.submissionDate=f.changedOn)}}b.requests=a,b.loading=!1},j=function(){b.loading=!1};e.getStatusFilterData(function(a){b.REQUEST_STATUS=a}),b.searchStatus={},b.loading=!0,c.query({},i,j),b.actions=e.actions,b.showApplicant=g.roles.filter(function(a){return[h.dao,h.admin].indexOf(a)>-1}).length>0,b.deleteRequest=function(c){b.requestToDelete=c.id,a.$broadcast(f.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[c.title,c.applicant]},c.id)},b.$on(f.confirmDialogAccepted,function(a,e){b.requestToDelete===e&&(d["delete"]({id:b.requestToDelete},function(){b.loading=!0,c.query({},i,j)}),delete b.requestToDelete)})}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$location","$routeParams","$filter","DataAccessRequestResource","DataAccessRequestService","DataAccessRequestStatusResource","DataAccessFormResource","DataAccessFormService","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.form={schema:null,definition:null,model:{},comments:null};var p=function(a){m.alert({id:"DataAccessRequestViewController",type:"danger",msg:n.buildMessage(a)})},q=function(a){switch(b.selectedTab=a,a){case"form":break;case"comments":r()}},r=function(){b.form.comments=k.query({id:d.id})},s=function(a){k.save({id:d.id},a.message,r,p)},t=function(a){l.update({id:d.id,commentId:a.id},a.message,r,p)},u=function(c){b.commentToDelete=c.id,a.$broadcast(o.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[c.createdBy]},c.id)};b.$on(o.confirmDialogAccepted,function(a,c){b.commentToDelete===c&&l["delete"]({id:d.id,commentId:c},{},r,p)}),b.getDownloadHref=function(a,c){return"/ws/data-access-request/"+b.dataAccessRequest.id+"/attachments/"+c+"/_download"},b.actions=g.actions,b.nextStatus=g.nextStatus,b.selectTab=q,b.submitComment=s,b.updateComment=t,b.deleteComment=u,b.getStatusHistoryInfoId=g.getStatusHistoryInfoId,g.getStatusHistoryInfo(function(a){b.getStatusHistoryInfo=a}),b.validForm=!0;var v=function(){return f.get({id:d.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{}}catch(c){b.validForm=!1,b.form.model={},m.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}
// Retrieve form data
return i.get(function(a){b.form.definition=j.parseJsonSafely(a.definition,[]),b.form.schema=j.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.validForm=!1,b.form.definition=[],m.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.validForm=!1,b.form.schema={readonly:!0},m.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.form.schema.readonly=!0,b.$broadcast("schemaFormRedraw")},p),a.attachments=a.attachments||[],a})};b.dataAccessRequest=d.id?v():{},b["delete"]=function(){b.requestToDelete=b.dataAccessRequest.id,a.$broadcast(o.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.dataAccessRequest.title,b.dataAccessRequest.applicant]},b.requestToDelete)},b.$on(o.confirmDialogAccepted,function(a,d){b.requestToDelete===d&&(f["delete"]({id:b.requestToDelete},function(){c.path("/data-access-requests").replace()}),delete b.requestToDelete)});var w=function(){b.dataAccessRequest=v()},x=function(b,c,d){a.$broadcast(o.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==c?c:"data-access-request.status-change-confirmation.message",messageArgs:null!==d?[e("translate")(d).toLowerCase()]:[]},b)},y=function(a,c){a===c&&h.update({id:b.dataAccessRequest.id,status:a},w,p)};b.submit=function(){b.$broadcast("schemaFormValidate"),b.forms.requestForm.$valid?h.update({id:b.dataAccessRequest.id,status:g.status.SUBMITTED},w,p):m.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},b.reopen=function(){x(g.status.OPENED,null,"reopen")},b.review=function(){x(g.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)},b.approve=function(){x(g.status.APPROVED,null,"approve")},b.reject=function(){x(g.status.REJECTED,null,"reject")},b.$on(o.confirmDialogAccepted,function(a,b){y(g.status.OPENED,b)}),b.$on(o.confirmDialogAccepted,function(a,b){y(g.status.REVIEWED,b)}),b.$on(o.confirmDialogAccepted,function(a,b){y(g.status.APPROVED,b)}),b.$on(o.confirmDialogAccepted,function(a,b){y(g.status.REJECTED,b)}),b.forms={}}]).controller("DataAccessRequestEditController",["$log","$scope","$routeParams","$location","$modal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormResource","DataAccessFormService","AlertService","ServerErrorUtils","Session","DataAccessRequestService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(a,b){var c=b().location.split("/");d.path("/data-access-request/"+c[c.length-1]).replace()},o=function(a){j.alert({id:"DataAccessRequestEditController",type:"danger",msg:k.buildMessage(a)})},p=function(){b.$broadcast("schemaFormValidate"),e.open({scope:b,templateUrl:"access/views/data-access-request-validation-modal.html"})},q=function(){d.path("/data-access-request"+(c.id?"/"+c.id:"s")).replace()},r=function(){b.dataAccessRequest.content=JSON.stringify(b.form.model),b.newRequest?f.save(b.dataAccessRequest,n,o):g.save(b.dataAccessRequest,function(){d.path("/data-access-request"+(b.dataAccessRequest.id?"/"+b.dataAccessRequest.id:"s")).replace()},o)};
// Retrieve form data
h.get(function(a){b.form.definition=i.parseJsonSafely(a.definition,[]),b.form.schema=i.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.form.definition=[],b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.form.schema={},b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.validForm&&(b.dataAccessRequest=c.id?g.get({id:c.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{}}catch(c){b.form.model={},j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-request.parse-error"})}return b.canEdit=m.actions.canEdit(a),b.form.schema.readonly=!b.canEdit,b.$broadcast("schemaFormRedraw"),a.attachments=a.attachments||[],a}):{applicant:l.login,status:m.status.OPENED,attachments:[]})},o),b.validForm=!0,b.requestId=c.id,b.newRequest=c.id?!1:!0,b.cancel=q,b.save=r,b.editable=!0,b.validate=p,b.form={schema:null,definition:null,model:{}}}]),angular.module("dataAccessRequest").config(["$routeProvider",function(a){a.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"})}]),angular.module("dataAccessRequest").factory("DataAccessRequestsResource",["$resource",function(a){return a("ws/data-access-requests",{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource",function(a){return a("ws/data-access-request/:id",{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},get:{method:"GET"},"delete":{method:"DELETE"}})}]).factory("DataAccessRequestCommentsResource",["$resource",function(a){return a("ws/data-access-request/:id/comments",{},{save:{method:"POST",params:{id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource",function(a){return a("ws/data-access-request/:id/comment/:commentId",{},{"delete":{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource",function(a){return a("ws/data-access-request/:id/_status?to=:status",{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestService",["$translate",function(a){var b={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",APPROVED:"APPROVED",REJECTED:"REJECTED"};this.status=b,this.getStatusFilterData=function(c){c&&a(Object.keys(b)).then(function(a){c(Object.keys(a).map(function(b){return a[b]}))})};var c=function(a,b){return a.actions?-1!==a.actions.indexOf(b):null};this.actions={canView:function(a){return c(a,"VIEW")},canEdit:function(a){return c(a,"EDIT")},canEditStatus:function(a){return c(a,"EDIT_STATUS")},canDelete:function(a){return c(a,"DELETE")}};var d=function(a,b){return a.nextStatus?-1!==a.nextStatus.indexOf(b):null};return this.nextStatus={canSubmit:function(a){return d(a,"SUBMITTED")},canReopen:function(a){return d(a,"OPENED")},canReview:function(a){return d(a,"REVIEWED")},canApprove:function(a){return d(a,"APPROVED")},canReject:function(a){return d(a,"REJECTED")}},this.getStatusHistoryInfo=function(b){if(b){var c={"data-access-request.histories.opened":"opened","data-access-request.histories.reopened":"reopened","data-access-request.histories.submitted":"submitted","data-access-request.histories.reviewed":"reviewed","data-access-request.histories.approved":"approved","data-access-request.histories.rejected":"rejected"},d={opened:{id:"opened",icon:"glyphicon glyphicon-saved"},reopened:{id:"reopened",icon:"glyphicon glyphicon-repeat"},submitted:{id:"submitted",icon:"glyphicon glyphicon-export"},reviewed:{id:"reviewed",icon:"glyphicon glyphicon-check"},approved:{id:"approved",icon:"glyphicon glyphicon-ok"},rejected:{id:"rejected",icon:"glyphicon glyphicon-remove"}};a(Object.keys(c)).then(function(a){Object.keys(a).forEach(function(b){d[c[b]].msg=a[b]}),b(d)})}},this.getStatusHistoryInfoId=function(a){var b="opened";if("OPENED"!==a.from||a.from!==a.to)switch(a.to){case"OPENED":b="reopened";break;case"SUBMITTED":b="submitted";break;case"REVIEWED":b="reviewed";break;case"APPROVED":b="approved";break;case"REJECTED":b="rejected"}return b},this}]),angular.module("ngObibaMica",["dataAccessRequest"]),angular.module("templates-ngObibaMica",["access/views/data-access-request-form.html","access/views/data-access-request-histroy-view.html","access/views/data-access-request-list.html","access/views/data-access-request-validation-modal.html","access/views/data-access-request-view.html"]),angular.module("access/views/data-access-request-form.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-form.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <h2>\n    <ol class="mica-breadcrumb">\n      <li><a href="#/data-access-requests" translate>data-access-requests</a></li>\n      <li ng-if="!newRequest"><a href="#/data-access-request/{{requestId}}">{{requestId}}</a></li>\n      <li class="active">\n        <span ng-if="newRequest" translate>add-sm</span>\n        <span ng-if="!newRequest" translate>edit-sm</span>\n        <small><span translate>or</span>\n          <a ng-click="cancel()">\n            <span translate>cancel-sm</span>\n          </a></small>\n      </li>\n    </ol>\n  </h2>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <div class="pull-right">\n      <a ng-click="cancel()" type="button" class="btn btn-default">\n        <span translate>cancel</span>\n      </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n      <a ng-click="validate()" type="button" class="btn btn-info">\n        <span translate>validate</span>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <form name="form.requestForm" ng-submit="submit(form.requestForm)">\n      <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema" required="true"></div>\n      <h2 translate>data-access-request.documents</h2>\n      <p translate>data-access-request.documents-help</p>\n      <div class="form-group">\n        <attachment-input files="dataAccessRequest.attachments" multiple="true"></attachment-input>\n      </div>\n    </form>\n  </div>\n\n</div>\n')}]),angular.module("access/views/data-access-request-histroy-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-histroy-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<table id="data-access-request-history" class="table table-striped">\n  <thead>\n  <tr>\n    <th class="status-icon"></th>\n    <th translate>status</th>\n    <th translate>changed-by</th>\n    <th translate>Changed On</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="status in dataAccessRequest.statusChangeHistory"\n    ng-init="info = getStatusHistoryInfo[getStatusHistoryInfoId(status)]">\n    <td><span><i class="{{info.icon}} hoffset"></i></span></td>\n    <td>{{info.msg}}</span></span></td>\n    <td>{{userProfileService.getFullName(status.profile) || status.author}}</td>\n    <td><span>{{status.changedOn | fromNow}}</span></td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("access/views/data-access-request-list.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-list.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div id="data-access-request-list">\n\n  <h2>\n    <span translate>data-access-requests</span>\n  </h2>\n  <a ng-href="#/data-access-request/new" class="btn btn-info">\n    <i class="fa fa-plus"></i> <span translate>data-access-request.add</span>\n  </a>\n\n  <p class="help-block" ng-if="requests.length == 0 && !loading">\n    <span translate>data-access-request.none</span>\n  </p>\n\n  <p ng-if="loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search"><i\n            class="glyphicon glyphicon-search"></i></span>\n          <input ng-model="searchText" type="text" class="form-control"\n            aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-2">\n        <div class="input-group">\n          <ui-select id="status-select" theme="bootstrap" ng-model="searchStatus.filter" reset-search-input="true">\n            <ui-select-match allow-clear="true" placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n              <span ng-bind-html="$select.selected"></span>\n            </ui-select-match>\n            <ui-select-choices repeat="data in REQUEST_STATUS">\n              {{data}}\n            </ui-select-choices>\n          </ui-select>\n        </div>\n        </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th>ID</th>\n          <th translate ng-if="showApplicant">data-access-request.applicant</th>\n          <th translate>data-access-request.title</th>\n          <th translate>data-access-request.lastUpdate</th>\n          <th translate>data-access-request.submissionDate</th>\n          <th translate>data-access-request.status</th>\n          <th translate>actions</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr\n          dir-paginate="request in requests | filter:{status: searchStatus.filter} | filter:searchText | itemsPerPage: 20">\n          <td>\n            <a ng-href="#/data-access-request/{{request.id}}" ng-if="actions.canView(request)" translate>{{request.id}}</a>\n            <span ng-if="!actions.canView(request)">{{request.id}}</span>\n          </td>\n          <td ng-if="showApplicant">\n            {{userProfileService.getFullName(request.profile) || request.applicant}}\n          </td>\n          <td>\n            {{request.title}}\n          </td>\n          <td>\n            {{(request.timestamps.lastUpdate || request.timestamps.created) | fromNow}}\n          </td>\n          <td>\n            <span ng-if="request.submissionDate">{{request.submissionDate | fromNow}}</span>\n          </td>\n          <td>\n            {{request.status | translate}}\n          </td>\n          <td>\n            <ul class="list-inline">\n              <li ng-if="actions.canEdit(request)">\n                <a ng-href="#/data-access-request/{{request.id}}/edit"  title="{{\'edit\' | translate}}"><i class="fa fa-pencil"></i></a>\n              </li>\n              <li>\n                <a ng-if="actions.canDelete(request)" ng-click="deleteRequest(request)" title="{{\'delete\' | translate}}"><i\n                  class="fa fa-trash-o"></i></a>\n              </li>\n            </ul>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n\n</div>\n')}]),angular.module("access/views/data-access-request-validation-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-validation-modal.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="form.requestForm.$valid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!form.requestForm.$valid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <h2>\n    <ol class="mica-breadcrumb">\n      <li><a href="#/data-access-requests" translate>data-access-requests</a></li>\n      <li class="active">{{dataAccessRequest.id}}</li>\n    </ol>\n  </h2>\n  <p>Testing</p>\n\n  <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <p class="help-block pull-left"><span translate>created-by</span> {{userProfileService.getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}},\n      <span>{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n      <span class="label label-success">{{dataAccessRequest.status}}</span></p>\n\n    <div class="pull-right">\n      <a ng-click="submit()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)"\n        class="btn btn-info" translate>submit\n      </a>\n      <a ng-click="reopen()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)"\n        class="btn btn-info" translate>reopen\n      </a>\n      <a ng-click="review()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)"\n        class="btn btn-info" translate>review\n      </a>\n      <a ng-click="approve()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)"\n        class="btn btn-info" translate>approve\n      </a>\n      <a ng-click="reject()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)"\n        class="btn btn-info" translate>reject\n      </a>\n      <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit"\n        ng-if="actions.canEdit(dataAccessRequest)"\n        class="btn btn-primary" title="{{\'edit\' | translate}}">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n      <a target="_self" ng-href="/ws/data-access-request/{{dataAccessRequest.id}}/_pdf" class="btn btn-default">\n        <i class="glyphicon glyphicon-download-alt"></i> <span translate>download</span>\n      </a>\n      <a ng-click="delete()"\n        ng-if="actions.canDelete(dataAccessRequest)"\n        class="btn btn-danger" title="{{\'delete\' | translate}}">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <tabset class="voffset5">\n      <tab ng-click="selectTab(\'form\')" heading="{{\'data-access-request.form\' | translate}}">\n        <form id="request-form" name="forms.requestForm">\n          <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema"></div>\n        </form>\n        <h2 translate>data-access-request.documents</h2>\n\n        <p ng-if="dataAccessRequest.attachments.length == 0" translate>\n          data-access-request.no-documents\n        </p>\n\n        <attachment-list files="dataAccessRequest.attachments"\n            href-builder="getDownloadHref(attachments, id)"></attachment-list>\n      </tab>\n      <tab ng-click="selectTab(\'comments\')" heading="{{\'data-access-request.comments\' | translate}}">\n        <obiba-comments comments="form.comments" on-update="updateComment" on-delete="deleteComment" name-resolver="userProfileService.getFullName" edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n        <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n      </tab>\n      <tab ng-click="selectTab(\'history\')" heading="{{\'data-access-request.history\' | translate}}">\n        <div ng-include="\'access/views/data-access-request-histroy-view.html\'"></div>\n      </tab>\n    </tabset>\n  </div>\n\n</div>\n')}]);