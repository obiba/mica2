/*!
 * ng-obiba-mica - v1.0.0
 * https://github.com/obiba/ng-obiba-mica

 * License: GNU Public License version 3
 * Date: 2016-03-16
 */
"use strict";function NgObibaMicaUrlProvider(){function a(a){var b=a;this.getUrl=function(a){return a in b?b[a]:null}}var b={DataAccessFormConfigResource:"ws/config/data-access-form",DataAccessRequestsResource:"ws/data-access-requests",DataAccessRequestResource:"ws/data-access-request/:id",DataAccessRequestAttachmentDownloadResource:"/ws/data-access-request/:id/attachments/:attachmentId/_download",DataAccessRequestDownloadPdfResource:"/ws/data-access-request/:id/_pdf",DataAccessRequestCommentsResource:"ws/data-access-request/:id/comments",DataAccessRequestCommentResource:"ws/data-access-request/:id/comment/:commentId",DataAccessRequestStatusResource:"ws/data-access-request/:id/_status?to=:status",TempFileUploadResource:"ws/files/temp",TempFileResource:"ws/files/temp/:id",TaxonomiesSearchResource:"ws/taxonomies/_search",TaxonomiesResource:"ws/taxonomies/_filter",TaxonomyResource:"ws/taxonomy/:taxonomy/_filter",VocabularyResource:"ws/taxonomy/:taxonomy/vocabulary/:vocabulary/_filter",JoinQuerySearchResource:"ws/:type/_rql?query=:query",JoinQueryCoverageResource:"ws/variables/_coverage?query=:query",JoinQueryCoverageDownloadResource:"ws/variables/_coverage_download?query=:query",VariablePage:"",NetworkPage:"#/network/:network",StudyPage:"#/study/:study",StudyPopulationsPage:"#/study/:study",DatasetPage:"#/:type/:dataset",BaseUrl:"/"};this.setUrl=function(a,c){a in b&&(b[a]=c)},this.$get=function(){return new a(b)}}function NgObibaMicaTemplateUrlFactory(){function a(a){var b=a;this.getHeaderUrl=function(a){return a in b?b[a].header:null},this.getFooterUrl=function(a){return a in b?b[a].footer:null}}var b={registry:null};b.setHeaderUrl=function(a,b){a in this.registry&&(this.registry[a].header=b)},b.setFooterUrl=function(a,b){a in this.registry&&(this.registry[a].footer=b)},b.$get=function(){return new a(this.registry)},this.create=function(a){return b.registry=a,b}}function targetToType(a){switch(a.toLocaleString()){case QUERY_TARGETS.NETWORK:return QUERY_TYPES.NETWORKS;case QUERY_TARGETS.STUDY:return QUERY_TYPES.STUDIES;case QUERY_TARGETS.DATASET:return QUERY_TYPES.DATASETS;case QUERY_TARGETS.VARIABLE:return QUERY_TYPES.VARIABLES}throw new Error("Invalid target: "+a)}function typeToTarget(a){switch(a.toLocaleString()){case QUERY_TYPES.NETWORKS:return QUERY_TARGETS.NETWORK;case QUERY_TYPES.STUDIES:return QUERY_TARGETS.STUDY;case QUERY_TYPES.DATASETS:return QUERY_TARGETS.DATASET;case QUERY_TYPES.VARIABLES:return QUERY_TARGETS.VARIABLE}throw new Error("Invalid type: "+a)}function CriteriaItemBuilder(a,b){function c(){d.term?(d.itemTitle=a.forLocale(d.term.title,d.lang),d.itemDescription=a.forLocale(d.term.description,d.lang),d.itemParentTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemParentDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemTitle||(d.itemTitle=d.term.name),d.itemParentTitle||(d.itemParentTitle=d.vocabulary.name)):(d.itemTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemParentTitle=a.forLocale(d.taxonomy.title,d.lang),d.itemParentDescription=a.forLocale(d.taxonomy.description,d.lang),d.itemTitle||(d.itemTitle=d.vocabulary.name),d.itemParentTitle||(d.itemParentTitle=d.taxonomy.name)),d.id=CriteriaIdGenerator.generate(d.taxonomy,d.vocabulary,d.term)}var d={type:null,rqlQuery:null,lang:b||"en",parent:null,children:[]};this.type=function(a){if(!RQL_NODE[a.toUpperCase()])throw new Error("Invalid node type:",a);return d.type=a,this},this.target=function(a){return d.target=a,this},this.parent=function(a){return d.parent=a,this},this.taxonomy=function(a){return d.taxonomy=a,this},this.vocabulary=function(a){return d.vocabulary=a,this},this.term=function(a){return d.term=a,this},this.rqlQuery=function(a){return d.rqlQuery=a,this},this.selectedTerm=function(a){return d.selectedTerms||(d.selectedTerms=[]),d.selectedTerms.push("string"==typeof a?a:a.name),this},this.selectedTerms=function(a){return d.selectedTerms=a.filter(function(a){return a}).map(function(a){return"string"==typeof a?a:a.name}),this},this.build=function(){return d.taxonomy&&d.vocabulary&&c(),d}}function CriteriaBuilder(a,b,c,d,e){this.newCriteriaItemBuilder=function(){return new CriteriaItemBuilder(d,e)},this.initialize=function(f){this.leafItemMap={},this.target=f,this.rootRql=a,this.taxonomies=c,this.LocalizedValues=d,this.lang=e,this.rootItem=this.newCriteriaItemBuilder().parent(b).type(this.target).rqlQuery(this.rootRql).target(this.target).build()},this.buildLeafItem=function(a,b,c,d,e){var f=this,g=new CriteriaItemBuilder(f.LocalizedValues,f.lang).type(d.name).target(f.target).taxonomy(a).vocabulary(b).rqlQuery(d).parent(e);return g.selectedTerms(c).build(),g.build()}}function CriterionState(){var a=[],b=[];this.dirty=!1,this.open=!1,this.loading=!0,this.addOnOpen=function(b){a.push(b)},this.addOnClose=function(a){b.push(a)},this.onOpen=function(){a.forEach(function(a){a()})},this.onClose=function(){b.forEach(function(a){a()})}}function GraphicChartsDataProvider(){function a(a){var b=a;this.getData=function(a){a&&b.$promise.then(a)}}this.$get=function(b,c,d,e,f,g){var h=g.queryDtoBuilder(f.getOptions().entityIds,f.getOptions().entityType);return new a(c.studies({query:h},function(a){return a},function(a){b.error("Server error",a)}))}}angular.module("ngObibaMica",["schemaForm","obiba.mica.utils","obiba.mica.file","obiba.mica.attachment","obiba.mica.access","obiba.mica.search","obiba.mica.graphics","obiba.mica.localized"]).constant("USER_ROLES",{all:"*",admin:"mica-administrator",reviewer:"mica-reviewer",editor:"mica-editor",user:"mica-user",dao:"mica-data-access-officer"}).config(["$provide",function(a){a.provider("ngObibaMicaUrl",NgObibaMicaUrlProvider)}]),angular.module("obiba.mica.utils",[]).factory("UserProfileService",function(){var a=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};return{getAttribute:function(b,c){return a(b,c)},getFullName:function(b){return b?b.attributes?a(b.attributes,"firstName")+" "+a(b.attributes,"lastName"):b.username:null}}}).service("GraphicChartsConfigurations",function(){this.getClientConfig=function(){return!0},this.setClientConfig=function(){return!0}}),angular.module("obiba.mica.file",["ngResource"]),angular.module("obiba.mica.file").filter("bytes",function(){return function(a){return null===a||"undefined"==typeof a?"":filesize(a)}}),angular.module("obiba.mica.file").factory("TempFileResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TempFileResource"),{},{get:{method:"GET"},"delete":{method:"DELETE"}})}]),angular.module("obiba.mica.attachment",["obiba.mica.file","ui","ui.bootstrap","ngFileUpload","templates-ngObibaMica"]),angular.module("obiba.mica.attachment").directive("attachmentList",[function(){return{restrict:"E",scope:{hrefBuilder:"&",files:"="},templateUrl:"attachment/attachment-list-template.html",link:function(a){a.attachments=[],a.hrefBuilder=a.hrefBuilder||function(a){return a.id},a.$watch("files",function(b){b&&(a.attachments=b.map(function(b){var c=angular.copy(b);return c.href=a.hrefBuilder({id:b.id}),c}))},!0)}}}]).directive("attachmentInput",[function(){return{restrict:"E",require:"^form",scope:{multiple:"=",accept:"@",files:"="},templateUrl:"attachment/attachment-input-template.html",controller:"AttachmentCtrl"}}]).controller("AttachmentCtrl",["$scope","$timeout","$log","Upload","TempFileResource","ngObibaMicaUrl",function(a,b,c,d,e,f){var g=function(g){c.debug("file",g);var h={showProgressBar:!0,lang:"en",progress:0,fileName:g.name,size:g.size};a.multiple?a.files.push(h):(a.files.splice(0,a.files.length),a.files.push(h)),a.upload=d.upload({url:f.getUrl("TempFileUploadResource"),method:"POST",file:g}).progress(function(a){h.progress=parseInt(100*a.loaded/a.total)}).success(function(a,d,f){var g=f().location.split("/"),i=g[g.length-1];e.get({id:i},function(a){c.debug("tempFile",a),h.id=a.id,h.md5=a.md5,h.justUploaded=!0,b(function(){h.showProgressBar=!1},1e3)})})};a.onFileSelect=function(b){a.uploadedFiles=b,a.uploadedFiles.forEach(function(a){g(a)})},a.deleteTempFile=function(b){e["delete"]({id:b},function(){for(var c=a.files.length;c--;){var d=a.files[c];d.justUploaded&&d.id===b&&a.files.splice(c,1)}})},a.deleteFile=function(b){for(var c=a.files.length;c--;)a.files[c].id===b&&a.files.splice(c,1)}}]),angular.module("obiba.mica.access",["pascalprecht.translate","obiba.alert","obiba.comments","obiba.mica.attachment","obiba.utils","angularMoment","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaAccessTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null}}))}]),angular.module("obiba.mica.access").controller("DataAccessRequestListController",["$rootScope","$scope","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessRequestService","NOTIFICATION_EVENTS","SessionProxy","USER_ROLES","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a){for(var c=0;c<a.length;c++){var d=a[c];if("OPENED"!==d.status)for(var e=0;e<d.statusChangeHistory.length;e++){var f=d.statusChangeHistory[e];"OPENED"===f.from&&"SUBMITTED"===f.to&&(d.submissionDate=f.changedOn)}}b.requests=a,b.loading=!1},m=function(){b.loading=!1};f.getStatusFilterData(function(a){b.REQUEST_STATUS=a}),b.headerTemplateUrl=j.getHeaderUrl("list"),b.footerTemplateUrl=j.getFooterUrl("list"),b.config=k.getOptions(),b.searchStatus={},b.loading=!0,d.query({},l,m),b.actions=f.actions,b.showApplicant=h.roles().filter(function(a){return[i.dao,i.admin].indexOf(a)>-1}).length>0,b.deleteRequest=function(c){b.requestToDelete=c.id,a.$broadcast(g.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[c.title,c.applicant]},c.id)},b.userProfile=function(a){b.applicant=a,c.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})};var n=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.getFullName=function(a){return a?a.attributes?n(a.attributes,"firstName")+" "+n(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?n(a.attributes,"email"):null},b.$on(g.confirmDialogAccepted,function(a,c){b.requestToDelete===c&&(e["delete"]({id:b.requestToDelete},function(){b.loading=!0,d.query({},l,m)}),delete b.requestToDelete)})}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$location","$uibModal","$routeParams","$filter","DataAccessRequestResource","DataAccessRequestService","DataAccessRequestStatusResource","DataAccessFormConfigResource","JsonUtils","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","ngObibaMicaUrl","ngObibaMicaAccessTemplateUrl","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=function(a){p.alert({id:"DataAccessRequestViewController",type:"danger",msg:q.buildMessage(a)})},u=function(){b.form.comments=l.query({id:e.id})},v=function(a){switch(b.selectedTab=a,a){case"form":break;case"comments":u()}},w=function(a){l.save({id:e.id},a.message,u,t)},x=function(a){m.update({id:e.id,commentId:a.id},a.message,u,t)},y=function(c){b.commentToDelete=c.id,a.$broadcast(r.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[c.createdBy]},c.id)};b.form={schema:null,definition:null,model:{},comments:null},b.$on(r.confirmDialogAccepted,function(a,c){b.commentToDelete===c&&m["delete"]({id:e.id,commentId:c},{},u,t)}),b.getDownloadHref=function(a,c){return n.getUrl("DataAccessRequestAttachmentDownloadResource").replace(":id",b.dataAccessRequest.id).replace(":attachmentId",c)},b.config=s.getOptions(),b.actions=h.actions,b.nextStatus=h.nextStatus,b.selectTab=v,b.submitComment=w,b.updateComment=x,b.deleteComment=y,b.headerTemplateUrl=o.getHeaderUrl("view"),b.footerTemplateUrl=o.getFooterUrl("view"),b.getStatusHistoryInfoId=h.getStatusHistoryInfoId,h.getStatusHistoryInfo(function(a){b.getStatusHistoryInfo=a}),b.validForm=!0;var z=function(){return g.get({id:e.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{},b.requestDownloadUrl=n.getUrl("DataAccessRequestDownloadPdfResource").replace(":id",b.dataAccessRequest.id)}catch(c){b.validForm=!1,b.form.model={},p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}return j.get(function(a){b.form.definition=k.parseJsonSafely(a.definition,[]),b.form.schema=k.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.validForm=!1,b.form.definition=[],p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.validForm=!1,b.form.schema={readonly:!0},p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.form.schema.readonly=!0,b.$broadcast("schemaFormRedraw")},t),a.attachments=a.attachments||[],a})};b.dataAccessRequest=e.id?z():{},b["delete"]=function(){b.requestToDelete=b.dataAccessRequest.id,a.$broadcast(r.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.dataAccessRequest.title,b.dataAccessRequest.applicant]},b.requestToDelete)},b.$on(r.confirmDialogAccepted,function(a,d){b.requestToDelete===d&&(g["delete"]({id:b.requestToDelete},function(){c.path("/data-access-requests").replace()}),delete b.requestToDelete)});var A=function(){b.dataAccessRequest=z()},B=function(b,c,d){a.$broadcast(r.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==c?c:"data-access-request.status-change-confirmation.message",messageArgs:null!==d?[f("translate")(d).toLowerCase()]:[]},b)},C=function(a,c){a===c&&i.update({id:b.dataAccessRequest.id,status:a},A,t)};b.submit=function(){b.$broadcast("schemaFormValidate"),b.forms.requestForm.$valid?i.update({id:b.dataAccessRequest.id,status:h.status.SUBMITTED},function(){A(),d.open({scope:b,templateUrl:"access/views/data-access-request-submitted-modal.html"})},t):p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},b.reopen=function(){B(h.status.OPENED,null,"reopen")},b.review=function(){B(h.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)},b.approve=function(){B(h.status.APPROVED,null,"approve")},b.reject=function(){B(h.status.REJECTED,null,"reject")},b.userProfile=function(a){b.applicant=a,d.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})};var D=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.getFullName=function(a){return a?a.attributes?D(a.attributes,"firstName")+" "+D(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?D(a.attributes,"email"):null},b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.OPENED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.REVIEWED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.APPROVED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.REJECTED,b)}),b.forms={}}]).controller("DataAccessRequestEditController",["$log","$scope","$routeParams","$location","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormConfigResource","JsonUtils","AlertService","ServerErrorUtils","SessionProxy","DataAccessRequestService","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(a,b){var c=b().location.split("/");d.path("/data-access-request/"+c[c.length-1]).replace()},q=function(a){j.alert({id:"DataAccessRequestEditController",type:"danger",msg:k.buildMessage(a)})},r=function(){b.$broadcast("schemaFormValidate"),e.open({scope:b,templateUrl:"access/views/data-access-request-validation-modal.html"})},s=function(){d.path("/data-access-request"+(c.id?"/"+c.id:"s")).replace()},t=function(){b.dataAccessRequest.content=JSON.stringify(b.form.model),b.newRequest?f.save(b.dataAccessRequest,p,q):g.save(b.dataAccessRequest,function(){d.path("/data-access-request"+(b.dataAccessRequest.id?"/"+b.dataAccessRequest.id:"s")).replace()},q)};h.get(function(a){b.form.definition=i.parseJsonSafely(a.definition,[]),b.form.schema=i.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.form.definition=[],b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.form.schema={},b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.validForm&&(b.dataAccessRequest=c.id?g.get({id:c.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{}}catch(c){b.form.model={},j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-request.parse-error"})}return b.canEdit=m.actions.canEdit(a),b.form.schema.readonly=!b.canEdit,b.$broadcast("schemaFormRedraw"),a.attachments=a.attachments||[],a}):{applicant:l.login(),status:m.status.OPENED,attachments:[]})},q),b.config=o.getOptions(),b.validForm=!0,b.requestId=c.id,b.newRequest=!c.id,b.cancel=s,b.save=t,b.editable=!0,b.validate=r,b.headerTemplateUrl=n.getHeaderUrl("form"),b.footerTemplateUrl=n.getFooterUrl("form"),b.form={schema:null,definition:null,model:{}}}]),angular.module("obiba.mica.access").config(["$routeProvider",function(a){a.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"})}]),angular.module("obiba.mica.access").factory("DataAccessFormConfigResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessRequestsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsResource"),{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},get:{method:"GET"},"delete":{method:"DELETE"}})}]).factory("DataAccessRequestCommentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentsResource"),{},{save:{method:"POST",params:{id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentResource"),{},{"delete":{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestStatusResource"),{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestConfig",function(){var a={newRequestButtonCaption:null,documentsSectionTitle:null,documentsSectionHelpText:null,downloadButtonCaption:null,commentsEnabled:!0,userListPageTitle:null};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("DataAccessRequestService",["$translate","SessionProxy",function(a,b){var c={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",APPROVED:"APPROVED",REJECTED:"REJECTED"};this.status=c,this.getStatusFilterData=function(b){b&&a(Object.keys(c)).then(function(a){b(Object.keys(a).map(function(b){return a[b]}))})};var d=function(a,b){return a.actions?-1!==a.actions.indexOf(b):null};this.actions={canViewProfile:function(a){var c=!1,d=b.roles();return angular.forEach(d,function(b){b===a&&(c=!0)}),c},canView:function(a){return d(a,"VIEW")},canEdit:function(a){return d(a,"EDIT")},canEditStatus:function(a){return d(a,"EDIT_STATUS")},canDelete:function(a){return d(a,"DELETE")}};var e=function(a,b){return a.nextStatus?-1!==a.nextStatus.indexOf(b):null};return this.nextStatus={canSubmit:function(a){return e(a,"SUBMITTED")},canReopen:function(a){return e(a,"OPENED")},canReview:function(a){return e(a,"REVIEWED")},canApprove:function(a){return e(a,"APPROVED")},canReject:function(a){return e(a,"REJECTED")}},this.getStatusHistoryInfo=function(b){if(b){var c={"data-access-request.histories.opened":"opened","data-access-request.histories.reopened":"reopened","data-access-request.histories.submitted":"submitted","data-access-request.histories.reviewed":"reviewed","data-access-request.histories.approved":"approved","data-access-request.histories.rejected":"rejected"},d={opened:{id:"opened",icon:"glyphicon glyphicon-saved"},reopened:{id:"reopened",icon:"glyphicon glyphicon-repeat"},submitted:{id:"submitted",icon:"glyphicon glyphicon-export"},reviewed:{id:"reviewed",icon:"glyphicon glyphicon-check"},approved:{id:"approved",icon:"glyphicon glyphicon-ok"},rejected:{id:"rejected",icon:"glyphicon glyphicon-remove"}};a(Object.keys(c)).then(function(a){Object.keys(a).forEach(function(b){d[c[b]].msg=a[b]}),b(d)})}},this.getStatusHistoryInfoId=function(a){var b="opened";if("OPENED"!==a.from||a.from!==a.to)switch(a.to){case"OPENED":b="reopened";break;case"SUBMITTED":b="submitted";break;case"REVIEWED":b="reviewed";break;case"APPROVED":b="approved";break;case"REJECTED":b="rejected"}return b},this}]).filter("filterProfileAttributes",function(){return function(a){var b=["email","firstName","lastName","createdDate","lastLogin","username"];return a.filter(function(a){return-1===b.indexOf(a.key)})}});var DISPLAY_TYPES={LIST:"list",COVERAGE:"coverage",GRAPHICS:"graphics"};angular.module("obiba.mica.search",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaSearchTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({search:{header:null,footer:null},classifications:{header:null,footer:null}}))}]).config(["$provide","$injector",function(a){a.provider("ngObibaMicaSearch",function(){var a=["LocalizedValues",function(a){return a.getLocal()}],b={taxonomyTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],searchTabsOrder:[DISPLAY_TYPES.LIST,DISPLAY_TYPES.COVERAGE,DISPLAY_TYPES.GRAPHICS],resultTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],listLabel:"search.list",coverageLabel:"search.coverage",graphicsLabel:"search.graphics",variables:{showSearchTab:!0,searchLabel:"search.variable.searchLabel",noResultsLabel:"search.variable.noResults",variablesColumn:{showVariablesStudiesColumn:!0,showVariablesDatasetsColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0}},datasets:{showSearchTab:!0,showDatasetsSearchFilter:!0,searchLabel:"search.variable.searchLabel",noResultsLabel:"search.dataset.noResults",datasetsColumn:{showDatasetsTypeColumn:!0,showDatasetsNetworkColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0}},studies:{showSearchTab:!0,searchLabel:"search.variable.searchLabel",noResultsLabel:"search.study.noResults",showStudiesSearchFilter:!0,studiesColumn:{showStudiesDesignColumn:!0,showStudiesQuestionnaireColumn:!0,showStudiesPmColumn:!0,showStudiesBioColumn:!0,showStudiesOtherColumn:!0,showStudiesParticipantsColumn:!0,showStudiesNetworksColumn:!0,showStudiesDatasetsColumn:!0,showStudiesHarmonizedDatasetsColumn:!0,showStudiesVariablesColumn:!0}},networks:{showSearchTab:!0,searchLabel:"search.variable.searchLabel",noResultsLabel:"search.network.noResults",networksColumn:{showNetworksStudiesColumn:!0,showNetworksStudyDatasetColumn:!0,showNetworksHarmonizedDatasetColumn:!0,showNetworksVariablesColumn:!0}},coverage:{groupBy:{study:!0,dce:!0,dataset:!0,dataschema:!0,network:!0}}};this.setLocaleResolver=function(b){a=b},this.setOptions=function(a){b=angular.merge(b,a),b.taxonomyTabsOrder=a.taxonomyTabsOrder||b.taxonomyTabsOrder,b.searchTabsOrder=a.searchTabsOrder||b.searchTabsOrder,b.resultTabsOrder=a.resultTabsOrder||b.resultTabsOrder},this.$get=["$q","$injector",function(c,d){function e(){var a=Object.keys(b.coverage.groupBy).filter(function(a){return b.coverage.groupBy[a]}).length>0;if(!a){var c=b.searchTabsOrder.indexOf(DISPLAY_TYPES.COVERAGE);c>-1&&b.searchTabsOrder.splice(c,1)}}return e(),{getLocale:function(b,e){return c.when(d.invoke(a),b,e)},getOptions:function(){return b}}}]})}]).run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}]),angular.module("obiba.mica.search").filter("regex",function(){return function(a,b,c){var d=[];try{var e=new RegExp(b,"i");d=a.filter(function(a){return c.some(function(b){return e.test(a[b])})})}catch(f){}return d}}).filter("orderBySelection",function(){return function(a,b){if(!a)return[];var c=[],d=[];return a.forEach(function(a){b[a.key]?c.push(a):d.push(a)}),c.concat(d)}}).filter("dceDescription",function(){return function(a){return a.split(":<p>").map(function(a){return"<p>"+a})[2]}});var QUERY_TYPES={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"},QUERY_TARGETS={NETWORK:"network",STUDY:"study",DATASET:"dataset",VARIABLE:"variable"},BUCKET_TYPES={NETWORK:"network",STUDY:"study",DCE:"dce",DATASCHEMA:"dataschema",DATASET:"dataset"},RQL_NODE={VARIABLE:"variable",DATASET:"dataset",STUDY:"study",NETWORK:"network",LIMIT:"limit",SORT:"sort",AND:"and",NAND:"nand",OR:"or",NOR:"nor",NOT:"not",FACET:"facet",LOCALE:"locale",AGGREGATE:"aggregate",BUCKET:"bucket",CONTAINS:"contains",IN:"in",OUT:"out",EQ:"eq",GT:"gt",GE:"ge",LT:"lt",LE:"le",BETWEEN:"between",MATCH:"match",EXISTS:"exists",MISSING:"missing"},VOCABULARY_TYPES={STRING:"string",INTEGER:"integer",DECIMAL:"decimal"},CriteriaIdGenerator={generate:function(a,b,c){return a&&b?a.name+"."+b.name+(c?"."+c.name:""):void 0}};CriteriaBuilder.prototype.fieldToVocabulary=function(a){var b={taxonomy:null,vocabulary:null},c=a;a.indexOf(".")<0&&(c="Mica_"+this.target+"."+a);var d=c.split(".",2),e=d[0],f=d[1],g=this.taxonomies.filter(function(a){return e===a.name});if(0===g.length)throw new Error("Could not find taxonomy:",e);b.taxonomy=g[0];var h=b.taxonomy.vocabularies.filter(function(a){return f===a.name});if(0===h.length)throw new Error("Could not find vocabulary:",f);return b.vocabulary=h[0],b},CriteriaBuilder.prototype.visitLeaf=function(a,b){var c=RQL_NODE.MATCH===a.name,d=a.args[c?1:0],e=a.args[c?0:1],f=this.fieldToVocabulary(d),g=this.buildLeafItem(f.taxonomy,f.vocabulary,e instanceof Array?e:[e],a,b);this.leafItemMap[g.id]=g,b.children.push(g)},CriteriaBuilder.prototype.getRootItem=function(){return this.rootItem},CriteriaBuilder.prototype.getLeafItemMap=function(){return this.leafItemMap},CriteriaBuilder.prototype.visitCondition=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c),this.visit(a.args[1],c)},CriteriaBuilder.prototype.visitNot=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c)},CriteriaBuilder.prototype.visit=function(a,b){switch(a.name){case RQL_NODE.NOT:this.visitNot(a,b);break;case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:this.visitCondition(a,b);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.LE:case RQL_NODE.LT:case RQL_NODE.GE:case RQL_NODE.GT:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:case RQL_NODE.MATCH:this.visitLeaf(a,b)}},CriteriaBuilder.prototype.build=function(){var a=this;this.rootRql.args.forEach(function(b){a.visit(b,a.rootItem)})},angular.module("obiba.mica.search").service("RqlQueryUtils",[function(){function a(a){var b=a.args.filter(function(a){switch(a.name){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:case RQL_NODE.NOT:case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}).pop();return b?a.args.findIndex(function(a){return a.name===b.name}):-1}function b(a,b,c){var d=c;return a.attributes&&a.attributes.some(function(a){return a.key===b?(d=a.value,!0):!1}),d}var c=this;this.vocabularyTermNames=function(a){return a&&a.terms?a.terms.map(function(a){return a.name}):[]},this.hasTargetQuery=function(a,b){return a.args.filter(function(a){switch(a.name){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.STUDY:case RQL_NODE.NETWORK:return b?b===a.name:!0;default:return!1}}).length>0},this.variableQuery=function(){return new RqlQuery(QUERY_TARGETS.VARIABLE)},this.eqQuery=function(a,b){var c=new RqlQuery(RQL_NODE.EQ);return c.args.push(b),c},this.aggregate=function(a){var b=new RqlQuery(RQL_NODE.AGGREGATE);return a.forEach(function(a){b.args.push(a)}),b},this.limit=function(a,b){var c=new RqlQuery(RQL_NODE.LIMIT);return c.args.push(a),c.args.push(b),c},this.inQuery=function(a,b){var c=b&&b.length>0,d=c?RQL_NODE.IN:RQL_NODE.EXISTS,e=new RqlQuery(d);return e.args.push(a),c&&e.args.push(b),e},this.matchQuery=function(a,b){var c=new RqlQuery(RQL_NODE.MATCH);return c.args.push(b||"*"),c.args.push(a),c},this.updateMatchQuery=function(a,b){return a.args[0]=b||"*",a},this.rangeQuery=function(a,b,d){var e=new RqlQuery(RQL_NODE.BETWEEN);return e.args.push(a),c.updateRangeQuery(e,b,d),e},this.updateQueryInternal=function(a,b){var c=b&&b.length>0;return c?a.args[1]=b:a.args.splice(1,1),a},this.mergeInQueryArgValues=function(a,b,c){var d=b&&b.length>0;if(d){var e=a.args[1];if(!e||c)a.args[1]=b;else{e instanceof Array||(e=[e]);var f=b.filter(function(a){return-1===e.indexOf(a)});a.args[1]=e.concat(f)}}else a.args.splice(1,1);return a},this.updateRangeQuery=function(a,b,c,d){d?(a.name=RQL_NODE.MISSING,a.args.splice(1,1)):angular.isDefined(b)&&null!==b&&angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.BETWEEN,a.args[1]=[b,c]):angular.isDefined(b)&&null!==b?(a.name=RQL_NODE.GE,a.args[1]=b):angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.LE,a.args[1]=c):(a.name=RQL_NODE.EXISTS,a.args.splice(1,1))},this.buildRqlQuery=function(a){return this.isNumericVocabulary(a.vocabulary)?this.rangeQuery(this.criteriaId(a.taxonomy,a.vocabulary),null,null):this.isMatchVocabulary(a.vocabulary)?this.matchQuery(this.criteriaId(a.taxonomy,a.vocabulary),null):this.inQuery(this.criteriaId(a.taxonomy,a.vocabulary),a.term?a.term.name:void 0)},this.addQuery=function(b,c,d){if(0===b.args.length)b.args.push(c);else{var e=a(b);if(-1===e)b.args.push(c);else{var f=b.args.splice(e,1).pop(),g=new RqlQuery(d||RQL_NODE.OR);g.args.push(f,c),b.args.push(g)}}return b},this.updateQueryArgValues=function(a,b,c){switch(a.name){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.EXISTS:this.mergeInQueryArgValues(a,b,c)}},this.updateQuery=function(a,b){switch(a.name){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:this.updateQueryInternal(a,b)}},this.addLocaleQuery=function(a,b){var c=a.args.filter(function(a){
return a.name===RQL_NODE.LOCALE}).pop();if(!c){var d=new RqlQuery("locale");d.args.push(b),a.args.push(d)}},this.addLimit=function(a,b){var c=a.args.filter(function(a){return a.name===RQL_NODE.LIMIT}).pop();c?c.args=b.args:a.args.push(b)},this.addSort=function(a,b){var c=a.args.filter(function(a){return a.name===RQL_NODE.SORT}).pop();if(!c){var d=new RqlQuery("sort");d.args.push(b),a.args.push(d)}},this.criteriaId=function(a,b){return a.name+"."+b.name},this.vocabularyType=function(a){return b(a,"type",VOCABULARY_TYPES.STRING)},this.vocabularyField=function(a){return b(a,"field",a.name)},this.vocabularyAlias=function(a){return b(a,"alias",a.name)},this.isTermsVocabulary=function(a){return c.vocabularyType(a)===VOCABULARY_TYPES.STRING&&a.terms},this.isMatchVocabulary=function(a){return c.vocabularyType(a)===VOCABULARY_TYPES.STRING&&!a.terms},this.isNumericVocabulary=function(a){return!a.terms&&(c.vocabularyType(a)===VOCABULARY_TYPES.INTEGER||c.vocabularyType(a)===VOCABULARY_TYPES.DECIMAL)},this.isRangeVocabulary=function(a){return a.terms&&(c.vocabularyType(a)===VOCABULARY_TYPES.INTEGER||c.vocabularyType(a)===VOCABULARY_TYPES.DECIMAL)}}]).service("RqlQueryService",["$q","TaxonomiesResource","TaxonomyResource","LocalizedValues","RqlQueryUtils",function(a,b,c,d,e){function f(a,b){return b.args.filter(function(b){return b.name===a}).pop()}function g(a){switch(a.type){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}function h(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(-1===f||-1===g)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),null!==b.parent&&0===e.args.length&&h(b)}function i(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(-1===f||-1===g)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),0===e.args.length&&h(b)}function j(a){var b=a.parent;if(!b)throw new Error("Cannot remove criteria when parent is NULL");var c=a.rqlQuery,d=a.parent.rqlQuery,e=d.args.indexOf(c);if(-1===e)throw new Error("Criteria node not found: "+a);d.args.splice(e,1),-1!==[RQL_NODE.OR,RQL_NODE.AND,RQL_NODE.NAND,RQL_NODE.NOR].indexOf(b.type)?i(b):0===d.args.length&&h(b)}var k={variable:null,dataset:null,study:null,network:null};this.removeCriteriaItem=function(a){g(a)?j(a):h(a)},this.createCriteriaItem=function(a,b,e,f,g){function h(b,c,e){return new CriteriaItemBuilder(d,g).target(a).taxonomy(b).vocabulary(c).term(e)}return angular.isString(b)?c.get({target:a,taxonomy:b}).$promise.then(function(a){return e=a.vocabularies.filter(function(a){return a.name===e})[0],f=e.terms.filter(function(a){return a.name===f})[0],h(a,e,f).build()}):h(b,e,f).build()},this.addCriteriaItem=function(a,b,c){var d=a.args.filter(function(a){return b.target===a.name}).pop();d||(d=new RqlQuery(RQL_NODE[b.target.toUpperCase()]),a.args.push(d));var f=b.rqlQuery?b.rqlQuery:e.buildRqlQuery(b);return e.addQuery(d,f,c)},this.updateCriteriaItem=function(a,b,c){var d;d=b.rqlQuery?b.rqlQuery.args[1]:b.term?[b.term.name]:e.vocabularyTermNames(b.vocabulary),e.updateQueryArgValues(a.rqlQuery,d,c)},this.builders=function(c,e,f,g){function h(a,b){var e=new CriteriaBuilder(a,b,k[c],d,g);e.initialize(c),e.build(),i.resolve({root:e.getRootItem(),map:e.getLeafItemMap()})}var i=a.defer();return k[c]?h(e,f):b.get({target:c}).$promise.then(function(a){k[c]=a,h(e,f)}),i.promise},this.createCriteria=function(b,c){var d=a.defer(),f=(new CriteriaItemBuilder).type(RQL_NODE.AND).rqlQuery(b).build(),g={};if(!e.hasTargetQuery(b))return d.resolve({root:f,map:g}),d.promise;var h=[],i=this,j=0;return b.args.forEach(function(a){QUERY_TARGETS[a.name.toUpperCase()]&&h.push(a)}),h.forEach(function(a){i.builders(a.name,a,f,c).then(function(a){f.children.push(a.root),g=angular.extend(g,a.map),j++,j===h.length&&d.resolve({root:f,map:g})})}),d.promise},this.prepareCriteriaTermsQuery=function(a,b,c){function d(a,b,c){if(!a||!a.args)return null;if((a.name===RQL_NODE.IN||a.name===RQL_NODE.MISSING||a.name===RQL_NODE.CONTAINS)&&a.args[0]===b)return a;for(var e=a.args.length;e--;){var f=d(a.args[e],b,c);f&&(a.args[e]=c)}}var f=(new RqlParser).parse(a),g=f.args.filter(function(a){return a.name===b.target}).pop();if(g){var h=new RqlQuery(RQL_NODE.EXISTS),i=e.criteriaId(b.taxonomy,b.vocabulary);h.args.push(i),d(g,i,h),g.args.push(e.aggregate([i])),g.args.push(e.limit(0,0))}return f.args.push(new RqlQuery(RQL_NODE.FACET)),c&&e.addLocaleQuery(f,c),f.serializeArgs(f.args)},this.prepareSearchQuery=function(a,b,c,d,g){var h=angular.copy(b),i=typeToTarget(a);e.addLocaleQuery(h,d);var j=f(i,h);j||(j=new RqlQuery(i),h.args.push(j));var k=c[i]||{from:0,size:10};return e.addLimit(j,e.limit(k.from,k.size)),g&&e.addSort(j,g),(new RqlQuery).serializeArgs(h.args)},this.prepareCoverageQuery=function(a,b){var c,d=(new RqlParser).parse(a),e=new RqlQuery("aggregate");switch(b){case BUCKET_TYPES.NETWORK:c="networkId";break;case BUCKET_TYPES.STUDY:c="studyIds";break;case BUCKET_TYPES.DCE:c="dceIds";break;case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET:c="datasetId"}var f=new RqlQuery("bucket");f.args.push(c),e.args.push(f);var g;if(d.args.forEach(function(a){g||"variable"!==a.name||(g=a)}),g||(g=new RqlQuery("variable"),d.args.push(g)),g.args.length>0&&"limit"!==g.args[0].name){var h=new RqlQuery("in");h.args.push("Mica_variable.variableType"),b===BUCKET_TYPES.NETWORK||b===BUCKET_TYPES.DATASCHEMA?h.args.push("Dataschema"):h.args.push("Study");var i=new RqlQuery("and");i.args.push(h),i.args.push(g.args[0]),g.args[0]=i}return g.args.push(e),d.serializeArgs(d.args)},this.prepareGraphicsQuery=function(a,b,c){var d=(new RqlParser).parse(a),e=new RqlQuery(RQL_NODE.AGGREGATE);if(b.forEach(function(a){e.args.push(a)}),c&&c.length>0){var f=new RqlQuery(RQL_NODE.BUCKET);c.forEach(function(a){f.args.push(a)}),e.args.push(f)}var g,h=!1,i=!1;return d.args.forEach(function(a){if("study"===a.name){i=!0;var b=null;h=a.args.filter(function(a,c){return"limit"===a.name&&(b=c),["limit","sort","aggregate"].indexOf(a.name)<0}).length,null!==b&&a.args.splice(b,1),g=a}}),i||(g=new RqlQuery("study"),d.args.push(g)),h||g.args.push(new RqlQuery(RQL_NODE.MATCH)),g.args.push(e),d.args.push(new RqlQuery("facet")),d.serializeArgs(d.args)},this.getTargetAggregations=function(a,b,c){function f(a,b){var e=b.terms;if(e&&e.length>0){var f=a&&a.map(function(a){return a.key})||[];if(a){var g=[];return e.forEach(function(a){0!==f.length&&-1!==f.indexOf(a.name)||g.push({count:0,"default":0,description:d.forLocale(a.description,c),key:a.name,title:d.forLocale(a.title,c)})}),a.concat(g)}return e.map(function(a){return{count:0,"default":0,description:d.forLocale(a.description,c),key:a.name,title:d.forLocale(a.title,c)}})}return a}function g(a,b){if(a.children){var c=a.children.filter(function(a){return a.hasOwnProperty(b)}).pop();if(c)return c[b]}return null}var h=e.vocabularyAlias(b.vocabulary),i=a[b.target+"ResultDto"];if(i&&i.aggs){var j=b.taxonomy.name.startsWith("Mica_"),k=j?h:b.taxonomy.name,l=i.aggs.filter(function(a){return a.aggregation===k}).pop();if(l){if(j)return e.isNumericVocabulary(b.vocabulary)?l["obiba.mica.StatsAggregationResultDto.stats"]:e.isRangeVocabulary(b.vocabulary)?f(l["obiba.mica.RangeAggregationResultDto.ranges"],b.vocabulary):f(l["obiba.mica.TermsAggregationResultDto.terms"],b.vocabulary);var m=l.children.filter(function(a){return a.aggregation===h}).pop();if(m)return e.isRangeVocabulary(b.vocabulary)?f(g(l,"obiba.mica.RangeAggregationResultDto.ranges"),b.vocabulary):f(g(l,"obiba.mica.TermsAggregationResultDto.terms"),b.vocabulary)}}return f([],b.vocabulary)}}]),angular.module("obiba.mica.search").factory("TaxonomiesSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesSearchResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomiesResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomyResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(a,b,c){return a(b.getUrl("TaxonomyResource"),{},{get:{method:"GET",errorHandler:!0,cache:c("taxonomyResource")}})}]).factory("JoinQuerySearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQuerySearchResource"),{},{variables:{method:"GET",errorHandler:!0,params:{type:"variables"}},studies:{method:"GET",errorHandler:!0,params:{type:"studies"}},networks:{method:"GET",errorHandler:!0,params:{type:"networks"}},datasets:{method:"GET",errorHandler:!0,params:{type:"datasets"}}})}]).factory("JoinQueryCoverageResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQueryCoverageResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("VocabularyResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("VocabularyResource"),{},{get:{method:"GET",errorHandler:!0}})}]).service("SearchContext",function(){var a=null;this.setLocale=function(b){a=b},this.currentLocale=function(){return a}}).service("PageUrlService",["ngObibaMicaUrl","StringUtils",function(a,b){return this.studyPage=function(c){return c?b.replaceAll(a.getUrl("StudyPage"),{":study":c}):""},this.studyPopulationPage=function(c,d){return c?b.replaceAll(a.getUrl("StudyPopulationsPage"),{":study":c,":population":d}):""},this.networkPage=function(c){return c?b.replaceAll(a.getUrl("NetworkPage"),{":network":c}):""},this.datasetPage=function(c,d){var e=("study"===d.toLowerCase()?"study":"harmonization")+"-dataset",f=c?b.replaceAll(a.getUrl("DatasetPage"),{":type":e,":dataset":c}):"";return f},this.VariablePage=function(c){return c?b.replaceAll(a.getUrl("VariablePage"),{":variable":c}):""},this.downloadCoverage=function(c){return b.replaceAll(a.getUrl("JoinQueryCoverageDownloadResource"),{":query":c})},this}]).service("ObibaSearchConfig",function(){var a={networks:{showSearchTab:1},studies:{showSearchTab:1},datasets:{showSearchTab:1},variables:{showSearchTab:1}};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("CoverageGroupByService",["ngObibaMicaSearch",function(a){var b=a.getOptions().coverage.groupBy;return{canShowStudy:function(){return b.study||b.dce},canShowDce:function(a){return(a===BUCKET_TYPES.STUDY||a===BUCKET_TYPES.DCE)&&b.study&&b.dce},canShowDataset:function(){return b.dataset||b.dataschema},canShowDatasetStudyDataschema:function(a){return(a===BUCKET_TYPES.DATASET||a===BUCKET_TYPES.DATASCHEMA)&&b.dataset&&b.dataschema},canShowNetwork:function(){return b.network},studyTitle:function(){return b.study?"search.coverage-buckets.study":b.dce?"search.coverage-buckets.dce":""},studyBucket:function(){return b.study?BUCKET_TYPES.STUDY:BUCKET_TYPES.DCE},datasetTitle:function(){return b.dataset&&b.dataschema?"search.coverage-buckets.datasetNav":b.dataset?"search.coverage-buckets.dataset":b.dataschema?"search.coverage-buckets.dataschema":""},datasetBucket:function(){return b.dataset?BUCKET_TYPES.DATASET:BUCKET_TYPES.DATASCHEMA},canGroupBy:function(a){return b.hasOwnProperty(a)&&b[a]},defaultBucket:function(){return b.study?BUCKET_TYPES.STUDY:b.dce?BUCKET_TYPES.DCE:b.dataset?BUCKET_TYPES.DATASET:b.dataschema?BUCKET_TYPES.DATASCHEMA:b.network?BUCKET_TYPES.NETWORK:""}}}]).factory("CriteriaNodeCompileService",["$templateCache","$compile",function(a,b){return{compile:function(c,d){var e="";e=c.item.type===RQL_NODE.OR||c.item.type===RQL_NODE.AND||c.item.type===RQL_NODE.NAND||c.item.type===RQL_NODE.NOR?angular.element(a.get("search/views/criteria/criteria-node-template.html")):angular.element('<criterion-dropdown criterion="item" query="query"></criterion-dropdown>'),b(e)(c,function(a){d.replaceWith(a)})}}}]),angular.module("obiba.mica.search").controller("SearchController",["$scope","$timeout","$routeParams","$location","TaxonomiesSearchResource","TaxonomiesResource","TaxonomyResource","VocabularyResource","ngObibaMicaSearchTemplateUrl","ngObibaMicaSearch","JoinQuerySearchResource","JoinQueryCoverageResource","AlertService","ServerErrorUtils","LocalizedValues","RqlQueryService","RqlQueryUtils","SearchContext","CoverageGroupByService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(){function b(a){var b=d.search()[a];return b&&b.split(",").filter(function(a){return a}).map(function(a){return a.trim()})}a.taxonomyNav=[];var c=b("taxonomyTabsOrder");a.taxonomyTabsOrder=(c||a.options.taxonomyTabsOrder).filter(function(a){return G[a]});var e=b("searchTabsOrder");a.searchTabsOrder=e||a.options.searchTabsOrder;var f=b("resultTabsOrder");a.resultTabsOrder=(f||a.options.resultTabsOrder).filter(function(a){return G[a]}),a.metaTaxonomy.$promise.then(function(b){a.taxonomyTabsOrder.forEach(function(c){var d=b.vocabularies.filter(function(a){return a.name===c}).pop();d&&d.terms&&d.terms.forEach(function(b){b.target=c;var d=b.title.filter(function(b){return b.locale===a.lang})[0],e=b.description?b.description.filter(function(b){return b.locale===a.lang})[0]:void 0;b.locale={title:d,description:e},b.terms&&b.terms.forEach(function(b){var c=b.title.filter(function(b){return b.locale===a.lang})[0],d=b.description?b.description.filter(function(b){return b.locale===a.lang})[0]:void 0;b.locale={title:c,description:d}}),a.taxonomyNav.push(b)})})})}function u(a){m.alert({id:"SearchController",type:"danger",msg:n.buildMessage(a),delay:5e3})}function v(a){if(!a||!QUERY_TYPES[a.toUpperCase()])throw new Error("Invalid type: "+a)}function w(a){if(a&&!BUCKET_TYPES[a.toUpperCase()])throw new Error("Invalid bucket: "+a)}function x(a){if(!a||!DISPLAY_TYPES[a.toUpperCase()])throw new Error("Invalid display: "+a)}function y(){return a.taxonomyTypeMap[a.resultTabsOrder[0]]}function z(){return a.searchTabsOrder[0]||DISPLAY_TYPES.LIST}function A(){try{var b=d.search(),c=a.resultTabsOrder.indexOf(F[b.type])>-1?b.type:y(),e=b.bucket&&s.canGroupBy(b.bucket)?b.bucket:s.defaultBucket(),f=a.searchTabsOrder.indexOf(b.display)>-1?b.display:z(),g=b.query||"";return v(c),w(e),x(f),a.search.type=c,a.search.bucket=e,a.search.display=f,a.search.query=g,a.search.rqlQuery=(new RqlParser).parse(g),!0}catch(h){m.alert({id:"SearchController",type:"danger",msg:h.message,delay:5e3})}return!1}function B(a){a.sort(function(a,b){return"network"===a.target||"variable"===b.target?-1:"variable"===a.target||"network"===b.target?1:a.target<b.target?1:a.target>b.target?-1:0})}function C(){if("/search"===d.$$path){var b=p.prepareSearchQuery(a.search.type,a.search.rqlQuery,a.search.pagination,a.lang,"variables"===a.search.type?"name":"acronym."+a.lang);switch(a.search.display){case DISPLAY_TYPES.LIST:a.search.loading=!0,a.search.executedQuery=b,k[a.search.type]({query:b},function(b){a.search.result.list=b,a.search.loading=!1},u);break;case DISPLAY_TYPES.COVERAGE:var c=Object.keys(a.search.criteriaItemMap).map(function(b){return a.search.criteriaItemMap[b]}).filter(function(a){return a.target===QUERY_TARGETS.VARIABLE&&"Mica_variable"!==a.taxonomy.name}).length>0;c&&(a.search.loading=!0,a.search.executedQuery=p.prepareCoverageQuery(b,a.search.bucket),l.get({query:a.search.executedQuery},function(b){a.search.result.coverage=b,a.search.loading=!1},u));break;case DISPLAY_TYPES.GRAPHICS:a.search.loading=!0,a.search.executedQuery=p.prepareGraphicsQuery(b,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-designs"]),k.studies({query:a.search.executedQuery},function(b){a.search.result.graphics=b,a.search.loading=!1},u)}}}function D(){A()&&p.createCriteria(a.search.rqlQuery,a.lang).then(function(b){a.search.criteria=b.root,a.search.criteria&&a.search.criteria.children&&B(a.search.criteria.children),a.search.criteriaItemMap=b.map,a.search.result={},a.search.query&&C()})}function E(){j.getLocale(function(b){angular.isArray(b)?(a.tabs=b,a.lang=b[0]):a.lang=b||a.lang,r.setLocale(a.lang),t(),D()})}a.options=j.getOptions(),a.taxonomyTypeMap={variable:"variables",study:"studies",network:"networks",dataset:"datasets"};var F=Object.keys(a.taxonomyTypeMap).reduce(function(b,c){return b[a.taxonomyTypeMap[c]]=c,b},{});a.targets=[],a.lang=o.getLocal(),a.metaTaxonomy=g.get({target:"taxonomy",taxonomy:"Mica_taxonomy"},function(b){a.targets=b.vocabularies.map(function(a){return a.name})});var G={variable:a.options.variables.showSearchTab,dataset:a.options.datasets.showSearchTab,study:a.options.studies.showSearchTab,network:a.options.networks.showSearchTab},H=function(){var a=d.search();delete a.query,d.search(a)};a.setLocale=function(b){a.lang=b,r.setLocale(a.lang),D()};var I=function(b,c){return a.target===b&&a.taxonomyName===c&&a.taxonomiesShown?void(a.taxonomiesShown=!1):(a.taxonomiesShown=!0,a.target=b,void(a.taxonomyName=c))},J=function(){a.target=null,a.taxonomyName=null},K=function(){var b=(new RqlQuery).serializeArgs(a.search.rqlQuery.args),c=d.search();""===b?delete c.query:c.query=b,d.search(c)},L=function(){a.documents.search.text=null,a.documents.search.active=!1},M=function(b){function c(a){var c=0,d=new RegExp(b,"ig");return a.itemTitle.match(d)?c=10:a.itemDescription&&a.itemDescription.match(d)?c=8:a.itemParentTitle.match(d)?c=6:a.itemParentDescription&&a.itemParentDescription.match(d)&&(c=4),c}return e.get({query:b,locale:a.lang,target:a.documents.search.target}).$promise.then(function(d){if(d){var e=[],f=0,g=10;if(d.forEach(function(b){var d=b.target,h=b.taxonomy;h.vocabularies&&h.vocabularies.filter(function(a){return!["dceIds","studyId","studyIds","networkId","datasetId"].filter(function(b){return a.name===b}).pop()}).forEach(function(b){if(b.terms)b.terms.forEach(function(i){if(e.length<g){var j=p.createCriteriaItem(d,h,b,i,a.lang);e.push({score:c(j),item:j})}f++});else{if(e.length<g){var i=p.createCriteriaItem(d,h,b,null,a.lang);e.push({score:c(i),item:i})}f++}})}),f>e.length){var h={query:b,total:f,size:g,message:"Showing "+g+" / "+f,status:"has-warning"};e.push({score:-1,item:h})}return e.sort(function(a,b){return b.score-a.score}),e.map(function(a){return a.item})}return[]})},N=function(b,c,d){if(b.id){var e=CriteriaIdGenerator.generate(b.taxonomy,b.vocabulary),f=a.search.criteriaItemMap[e];f?p.updateCriteriaItem(f,b,d):p.addCriteriaItem(a.search.rqlQuery,b,c),K(),a.selectedCriteria=null}else a.selectedCriteria=b.query},O=function(b){switch(b.keyCode){case 27:a.documents.search.active&&L();break;default:a.documents.search.text&&M(a.documents.search.text)}},P=function(a){if(a){v(a);var b=d.search();b.type=a,d.search(b)}},Q=function(a){if(a){w(a);var b=d.search();b.bucket=a,d.search(b)}},R=function(b,c,d){a.search.pagination[b]={from:c,size:d},D()},S=function(a){if(a){x(a);var b=d.search();b.display=a,d.search(b)}},T=function(b,c,d,e){c&&P(c),e&&Object.keys(a.search.criteriaItemMap).forEach(function(c){a.search.criteriaItemMap[c].target===b.target&&(p.removeCriteriaItem(a.search.criteriaItemMap[c]),delete a.search.criteriaItemMap[c])}),S(d&&a.search.display?a.search.display:DISPLAY_TYPES.LIST),N(b,RQL_NODE.AND,!0)},U=function(b,c,d,e){return d&&q.isNumericVocabulary(d)?void N(p.createCriteriaItem(b,c,d,null,a.lang)):void N(p.createCriteriaItem(b,c,d,e,a.lang))},V=function(b){a.documents.search.target=b},W=function(a){p.removeCriteriaItem(a),K()};a.goToSearch=function(){d.path("/search")},a.goToClassifications=function(){d.path("/classifications")},a.QUERY_TYPES=QUERY_TYPES,a.BUCKET_TYPES=BUCKET_TYPES,a.search={pagination:{},query:null,rqlQuery:new RqlQuery,executedQuery:null,type:null,bucket:null,result:{list:null,coverage:null,graphics:null},criteria:[],criteriaItemMap:{},loading:!1},a.documents={search:{text:null,active:!1,target:null}},a.searchHeaderTemplateUrl=i.getHeaderUrl("search"),a.classificationsHeaderTemplateUrl=i.getHeaderUrl("classifications"),a.selectSearchTarget=V,a.selectDisplay=S,a.searchCriteria=M,a.selectCriteria=N,a.searchKeyUp=O,a.showTaxonomy=I,a.clearTaxonomy=J,a.removeCriteriaItem=W,a.refreshQuery=K,a.clearSearchQuery=H,a.onTypeChanged=P,a.onBucketChanged=Q,a.onDisplayChanged=S,a.onUpdateCriteria=T,a.onSelectTerm=U,a.QUERY_TARGETS=QUERY_TARGETS,a.onPaginate=R,a.$on("$locationChangeSuccess",function(a,b){t(),a!==b&&D()}),E()}]).controller("TaxonomiesPanelController",["$scope","VocabularyResource","TaxonomyResource","TaxonomiesResource",function(a,b,c,d){a.metaTaxonomy=c.get({target:"taxonomy",taxonomy:"Mica_taxonomy"}),a.taxonomies={all:[],search:{text:null,active:!1},target:"variable",taxonomy:null,vocabulary:null};var e=function(b,c){var d=b.reduce(function(a,b){return a[b.name]=b,a},{});return a.metaTaxonomy.$promise.then(function(b){var e=b.vocabularies.filter(function(a){return a.name===c})[0];a.taxonomyGroups=e.terms.map(function(b){if(!b.terms){var c=d[b.name];return c?(c.title=b.title,c.description=b.description,{title:null,taxonomies:[c]}):null}var e=b.terms.map(function(a){var b=d[a.name];return b?(b.title=a.title,b.description=a.description,b):null}).filter(function(a){return a}),f=b.title.filter(function(b){return b.locale===a.lang})[0],g=b.description?b.description.filter(function(b){return b.locale===a.lang})[0]:void 0;return{title:f?f.text:null,description:g?g.text:null,taxonomies:e}}).filter(function(a){return a})})},f=function(b,c,d){a.taxonomies.taxonomy=b,a.taxonomies.vocabulary=c,a.taxonomies.term=d},g=function(b,c,d,e){a.onSelectTerm(b,c,d,e)};a.$watchGroup(["taxonomyName","target"],function(b){b[0]&&b[1]?(a.showTaxonomies&&a.showTaxonomies(),a.taxonomies.target=b[1],a.taxonomies.search.active=!1,a.taxonomies.all=null,a.taxonomies.taxonomy=null,a.taxonomies.vocabulary=null,a.taxonomies.term=null,c.get({target:b[1],taxonomy:b[0]},function(b){a.taxonomies.taxonomy=b,a.taxonomies.search.active=!1})):b[1]&&(a.taxonomies.target=b[1],a.taxonomies.search.active=!1,a.taxonomies.all=null,a.taxonomies.taxonomy=null,a.taxonomies.vocabulary=null,a.taxonomies.term=null,d.get({target:a.taxonomies.target},function(b){a.taxonomies.all=b,e(b,a.taxonomies.target),a.taxonomies.search.active=!1}))}),a.navigateTaxonomy=f,a.selectTerm=g}]).controller("SearchResultController",["$scope","ngObibaMicaSearch",function(a,b){function c(b){Object.keys(a.activeTarget).forEach(function(c){a.activeTarget[c].active=b===c})}a.targetTypeMap=a.$parent.taxonomyTypeMap,a.QUERY_TARGETS=QUERY_TARGETS,a.QUERY_TYPES=QUERY_TYPES,a.options=b.getOptions(),a.activeTarget={},a.activeTarget[QUERY_TYPES.VARIABLES]={active:!1,name:QUERY_TARGETS.VARIABLE,totalHits:0},a.activeTarget[QUERY_TYPES.DATASETS]={active:!1,name:QUERY_TARGETS.DATASET,totalHits:0},a.activeTarget[QUERY_TYPES.STUDIES]={active:!1,name:QUERY_TARGETS.STUDY,totalHits:0},a.activeTarget[QUERY_TYPES.NETWORKS]={active:!1,name:QUERY_TARGETS.NETWORK,totalHits:0},a.selectTarget=function(b){c(b),a.type=b,a.$parent.onTypeChanged(b)},a.$watchCollection("result",function(){a.result.list&&(a.activeTarget[QUERY_TYPES.VARIABLES].totalHits=a.result.list.variableResultDto.totalHits,a.activeTarget[QUERY_TYPES.DATASETS].totalHits=a.result.list.datasetResultDto.totalHits,a.activeTarget[QUERY_TYPES.STUDIES].totalHits=a.result.list.studyResultDto.totalHits,a.activeTarget[QUERY_TYPES.NETWORKS].totalHits=a.result.list.networkResultDto.totalHits)}),a.$watch("type",function(a){c(a)}),a.DISPLAY_TYPES=DISPLAY_TYPES}]).controller("CriterionLogicalController",["$scope",function(a){a.updateLogical=function(b){a.item.rqlQuery.name=b,a.$emit(CRITERIA_ITEM_EVENT.refresh)}}]).controller("CriterionDropdownController",["$scope","$filter","LocalizedValues","RqlQueryUtils","StringUtils",function(a,b,c,d,e){var f=function(){if(a.state.open){a.state.onClose();var b=a.state.dirty;a.state.open=!1,a.state.dirty=!1,b&&a.$emit(CRITERIA_ITEM_EVENT.refresh)}},g=function(){return a.state.open?void f():(a.state.open=!0,void a.state.onOpen())},h=function(){a.$emit(CRITERIA_ITEM_EVENT.deleted,a.criterion)},i=function(a){13===a.keyCode&&f()};a.state=new CriterionState,a.localize=function(b){return c.forLocale(b,a.criterion.lang)},a.localizeCriterion=function(){var d=a.criterion.rqlQuery;if((d.name===RQL_NODE.IN||d.name===RQL_NODE.CONTAINS)&&a.criterion.selectedTerms&&a.criterion.selectedTerms.length>0){var e=d.name===RQL_NODE.IN?" | ":" + ";return a.criterion.selectedTerms.map(function(b){if(!a.criterion.vocabulary.terms)return b;var d=a.criterion.vocabulary.terms.filter(function(a){return a.name===b}).pop();return d?c.forLocale(d.title,a.criterion.lang):b}).join(e)}var f=d.name;switch(d.name){case RQL_NODE.EXISTS:f=":"+b("translate")("any");break;case RQL_NODE.MISSING:f=":"+b("translate")("none");break;case RQL_NODE.EQ:f="="+d.args[1];break;case RQL_NODE.GE:f=">"+d.args[1];break;case RQL_NODE.LE:f="<"+d.args[1];break;case RQL_NODE.BETWEEN:f=":["+d.args[1]+")";break;case RQL_NODE.IN:case RQL_NODE.CONTAINS:f="";break;case RQL_NODE.MATCH:f=":match("+d.args[0]+")"}return c.forLocale(a.criterion.vocabulary.title,a.criterion.lang)+f},a.vocabularyType=function(a){return d.vocabularyType(a)},a.onKeyup=i,a.truncate=e.truncate,a.remove=h,a.openDropdown=g,a.closeDropdown=f,a.RqlQueryUtils=d}]).controller("MatchCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=function(){a.state.dirty=!0,e.updateMatchQuery(a.criterion.rqlQuery,a.match)},h=a.criterion.rqlQuery.args[0];a.match="*"===h?"":h,a.update=g,a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).controller("NumericCriterionController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=a.criterion.rqlQuery.args[1];angular.isArray(g)?(a.from=a.criterion.rqlQuery.args[1][0],a.to=a.criterion.rqlQuery.args[1][1]):(a.from=a.criterion.rqlQuery.name===RQL_NODE.GE?g:null,a.to=a.criterion.rqlQuery.name===RQL_NODE.LE?g:null);var h=function(){var c=a.criterion.target,e=b.prepareCriteriaTermsQuery(a.query,a.criterion);d[targetToType(c)]({query:e}).$promise.then(function(c){var d=b.getTargetAggregations(c,a.criterion,a.lang);d&&d["default"]&&(a.min=d["default"].min,a.max=d["default"].max)})},i=function(){h()},j=function(){a.updateSelection()};a.updateSelection=function(){e.updateRangeQuery(a.criterion.rqlQuery,a.from,a.to,a.selectMissing),a.state.dirty=!0},a.selectMissing=a.criterion.rqlQuery.name===RQL_NODE.MISSING,a.state.addOnClose(j),a.state.addOnOpen(i),a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).controller("StringCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","StringUtils","JoinQuerySearchResource","RqlQueryUtils","SearchContext","$filter",function(a,b,c,d,e,f,g,h){a.lang=g.currentLocale();var i=function(b){return-1!==a.checkboxTerms.indexOf(b)},j=function(){a.state.dirty=!0,a.criterion.rqlQuery.name=a.selectedFilter;var b=[];a.selectedFilter!==RQL_NODE.MISSING&&a.selectedFilter!==RQL_NODE.EXISTS&&Object.keys(a.checkboxTerms).forEach(function(c){a.checkboxTerms[c]&&b.push(c)}),0===b.length&&a.selectedFilter!==RQL_NODE.MISSING&&(a.criterion.rqlQuery.name=RQL_NODE.EXISTS),f.updateQuery(a.criterion.rqlQuery,b)},k=function(){j()},l=function(){return a.selectedFilter===RQL_NODE.IN},m=function(){return a.selectedFilter===RQL_NODE.CONTAINS},n=function(){a.state.loading=!0;var c=a.criterion.target,d=b.prepareCriteriaTermsQuery(a.query,a.criterion,a.lang);e[targetToType(c)]({query:d}).$promise.then(function(c){a.state.loading=!1,a.terms=b.getTargetAggregations(c,a.criterion,a.lang),a.terms&&(a.terms.forEach(function(b){a.checkboxTerms[b.key]=a.isSelectedTerm(b)}),a.terms=h("orderBySelection")(a.terms,a.checkboxTerms))})};a.isSelectedTerm=function(b){return a.criterion.selectedTerms&&-1!==a.criterion.selectedTerms.indexOf(b.key)},a.state.addOnOpen(n),a.checkboxTerms={},a.RQL_NODE=RQL_NODE,a.selectedFilter=a.criterion.type,a.isSelected=i,a.updateFilter=k,a.localize=function(b){return c.forLocale(b,a.criterion.lang)},a.truncate=d.truncate,a.isInFilter=l,a.isContainsFilter=m,a.updateSelection=j}]).controller("CoverageResultTableController",["$scope","$location","$q","PageUrlService","RqlQueryUtils","RqlQueryService","CoverageGroupByService",function(a,b,c,d,e,f,g){function h(a,b){switch(a){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.DCE:return d.studyPage(b);case BUCKET_TYPES.NETWORK:return d.networkPage(b);case BUCKET_TYPES.DATASCHEMA:return d.datasetPage(b,"harmonization");case BUCKET_TYPES.DATASET:return d.datasetPage(b,"study")}return""}function i(){function b(a){var b;return i[a]?(b=0,i[a]=i[a]+1):(b=1,i[a]=1),b}function c(a,b,c){j[a]?(b<j[a][0]&&(j[a][0]=b),c>j[a][1]&&(j[a][1]=c)):j[a]=[b,c]}function e(a,b){var c;if(a)if(a.indexOf("-")>0){var d=a.split("-");if(!b){var e=parseInt(d[1]);12>e?d[1]=e+1:(d[0]=parseInt(d[0])+1,d[1]=1)}var f=d[0]+"-"+d[1]+"-01";c=Date.parse(f)}else c=b?Date.parse(a+"-01-01"):Date.parse(a+"-12-31");return c}function f(a,b){var c=e(a,!0),d=b?e(b,!1):m,f=m>d?d:m;return d===c?100:Math.round(a?100*(f-c)/(d-c):0)}var g={colSpan:a.bucket===BUCKET_TYPES.DCE?3:1,ids:{}},i={},j={},k=(new Date).getFullYear(),l=(new Date).getMonth()+1,m=e(k+"-"+l,!0);return a.result.rows.forEach(function(e){if(g.ids[e.value]=[],a.bucket===BUCKET_TYPES.DCE){var i,j,m=e.value.split(":"),n=e.title.split(":"),o=e.description.split(":");j=m[0],i=b(j),c(j,e.start,e.end),g.ids[e.value].push({id:j,url:d.studyPage(j),title:n[0],description:o[0],rowSpan:i}),j=m[0]+":"+m[1],i=b(j),g.ids[e.value].push({id:j,url:d.studyPopulationPage(m[0],m[1]),title:n[1],description:o[1],rowSpan:i}),g.ids[e.value].push({id:e.value,title:n[2],description:o[2],start:e.start,current:k+"-"+l,end:e.end,url:d.studyPopulationPage(m[0],m[1]),rowSpan:1})}else g.ids[e.value].push({id:e.value,url:h(a.bucket,e.value),title:e.title,description:e.description,min:e.start,start:e.start,current:k,end:e.end,max:e.end,progressStart:0,progress:f(e.start?e.start+"-01":void 0,e.end?e.end+"-12":void 0),rowSpan:1})}),a.bucket===BUCKET_TYPES.DCE&&a.result.rows.forEach(function(a){g.ids[a.value][0].rowSpan>0&&(g.ids[a.value][0].rowSpan=i[g.ids[a.value][0].id]),g.ids[a.value][1].rowSpan>0&&(g.ids[a.value][1].rowSpan=i[g.ids[a.value][1].id]);var b=a.value.split(":");if(j[b[0]]){var c=j[b[0]][0],d=j[b[0]][1],f=g.ids[a.value][2].start,h=g.ids[a.value][2].end,k=e(d,!1)-e(c,!0);g.ids[a.value][2].min=c,g.ids[a.value][2].max=d,g.ids[a.value][2].progressStart=100*(e(f,!0)-e(c,!0))/k,g.ids[a.value][2].progress=100*(e(h,!1)-e(f,!0))/k}}),g}a.showMissing=!0,a.toggleMissing=function(b){a.showMissing=b},a.groupByOptions=g,a.bucketSelection={dceBucketSelected:a.bucket===BUCKET_TYPES.DCE,datasetBucketSelected:a.bucket!==BUCKET_TYPES.DATASCHEMA},a.$watch("bucketSelection.dceBucketSelected",function(b,c){b!==c&&(b?a.selectBucket(BUCKET_TYPES.DCE):a.bucket===BUCKET_TYPES.DCE&&a.selectBucket(BUCKET_TYPES.STUDY))}),a.$watch("bucketSelection.datasetBucketSelected",function(b,c){b!==c&&(b?a.selectBucket(BUCKET_TYPES.DATASET):a.bucket===BUCKET_TYPES.DATASET&&a.selectBucket(BUCKET_TYPES.DATASCHEMA))}),a.selectBucket=function(b){b===BUCKET_TYPES.STUDY&&a.bucketSelection.dceBucketSelected&&(b=BUCKET_TYPES.DCE),b!==BUCKET_TYPES.DATASET||a.bucketSelection.datasetBucketSelected||(b=BUCKET_TYPES.DATASCHEMA),a.bucket=b,a.$parent.onBucketChanged(b)},a.rowspans={},a.getSpan=function(b,c){
var d=0;if(c){var e=b+":"+c;return d=a.result.rows.filter(function(a){return a.title.startsWith(e+":")}).length,a.rowspans[e]=d,d}return d=a.result.rows.filter(function(a){return a.title.startsWith(b+":")}).length,a.rowspans[b]=d,d},a.hasSpan=function(b,c){return c?a.rowspans[b+":"+c]>0:a.rowspans[b]>0},a.hasVariableTarget=function(){var a=b.search().query;return a&&e.hasTargetQuery((new RqlParser).parse(a),RQL_NODE.VARIABLE)},a.hasSelected=function(){return a.table&&a.table.rows&&a.table.rows.filter(function(a){return a.selected}).length},a.BUCKET_TYPES=BUCKET_TYPES,a.downloadUrl=function(){return d.downloadCoverage(a.query)},a.$watch("result",function(){a.table={},a.table.cols=[],a.result&&a.result.rows&&(a.table=a.result,a.table.cols=i())});var j={};j[BUCKET_TYPES.NETWORK]=QUERY_TARGETS.NETWORK,j[BUCKET_TYPES.STUDY]=QUERY_TARGETS.STUDY,j[BUCKET_TYPES.DCE]=QUERY_TARGETS.VARIABLE,j[BUCKET_TYPES.DATASCHEMA]=QUERY_TARGETS.DATASET,j[BUCKET_TYPES.DATASET]=QUERY_TARGETS.DATASET,a.updateCriteria=function(b,d,e,g){for(var h,i=a.bucket===BUCKET_TYPES.DCE?"dceIds":"id",k=a.table.taxonomyHeaders[0].entity,l=0,m=0;m<a.table.vocabularyHeaders.length;m++)if(l+=a.table.vocabularyHeaders[m].termsCount,l>e){h=a.table.vocabularyHeaders[m].entity;break}var n={varItem:f.createCriteriaItem(QUERY_TARGETS.VARIABLE,k.name,h.name,d.entity.name)};b&&(n.item=f.createCriteriaItem(j[a.bucket],"Mica_"+j[a.bucket],i,b)),c.all(n).then(function(b){a.onUpdateCriteria(b.varItem,g,!1,!0),b.item&&a.onUpdateCriteria(b.item,g)})},a.updateFilterCriteria=function(){var b=a.bucket===BUCKET_TYPES.DCE?"dceIds":"id",d=a.table.rows.filter(function(a){return a.selected});c.all(d.map(function(c){return f.createCriteriaItem(j[a.bucket],"Mica_"+j[a.bucket],b,c.value)})).then(function(b){if(b.length){var c=b.reduce(function(a,b){return a?(f.updateCriteriaItem(a,b),a):(b.rqlQuery=e.buildRqlQuery(b),b)},null);a.onUpdateCriteria(c,"variables",!0)}})}}]).controller("GraphicsResultController",["GraphicChartsConfig","GraphicChartsUtils","RqlQueryService","$filter","$scope",function(a,b,c,d,e){var f=function(a,c,d,e,f){var g=b.getArrayByAggregation(a,c),h=g.map(function(a){return a.participantsNbr?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});return h.length>0?(h.unshift(d),angular.extend(f,{title:e}),{data:h,entries:g,options:f,vocabulary:a}):!1},g=a.getOptions().ChartsOptions;e.updateCriteria=function(a,b){c.createCriteriaItem("study","Mica_study",b,a).then(function(a){e.onUpdateCriteria(a,"studies")})},e.$watch("result",function(a){if(e.chartObjects={},e.noResults=!0,a&&a.studyResultDto.totalHits){e.noResults=!1;var b=f("populations-selectionCriteria-countriesIso",a.studyResultDto,[d("translate")(g.geoChartOptions.header[0]),d("translate")(g.geoChartOptions.header[1])],d("translate")(g.geoChartOptions.title)+" (N = "+a.studyResultDto.totalHits+")",g.geoChartOptions.options),c=f("methods-designs",a.studyResultDto,[d("translate")(g.studiesDesigns.header[0]),d("translate")(g.studiesDesigns.header[1]),d("translate")(g.studiesDesigns.header[2])],d("translate")(g.studiesDesigns.title)+" (N = "+a.studyResultDto.totalHits+")",g.studiesDesigns.options),h=f("numberOfParticipants-participant-range",a.studyResultDto,[d("translate")(g.numberParticipants.header[0]),d("translate")(g.numberParticipants.header[1])],d("translate")(g.numberParticipants.title)+" (N = "+a.studyResultDto.totalHits+")",g.numberParticipants.options),i=f("populations-dataCollectionEvents-bioSamples",a.studyResultDto,[d("translate")(g.biologicalSamples.header[0]),d("translate")(g.biologicalSamples.header[1])],d("translate")(g.biologicalSamples.title)+" (N = "+a.studyResultDto.totalHits+")",g.biologicalSamples.options);b&&angular.extend(e.chartObjects,{geoChartOptions:{chartObject:{geoTitle:b.options.title,options:b.options,type:"GeoChart",vocabulary:b.vocabulary,data:b.data,entries:b.entries}}}),c&&angular.extend(e.chartObjects,{studiesDesigns:{chartObject:{options:c.options,type:"google.charts.Bar",data:c.data,vocabulary:c.vocabulary,entries:c.entries}}}),h&&angular.extend(e.chartObjects,{numberParticipants:{chartObject:{options:h.options,type:"PieChart",data:h.data,vocabulary:h.vocabulary,entries:h.entries}}}),i&&angular.extend(e.chartObjects,{biologicalSamples:{chartObject:{options:i.options,type:"PieChart",data:i.data,vocabulary:i.vocabulary,entries:i.entries}}})}})}]).controller("SearchResultPaginationController",["$scope",function(a){function b(){a.maxSize=Math.min(3,Math.ceil(a.totalHits/a.pagination.selected.value))}function c(){var b=a.pagination.selected.value,c=a.pagination.currentPage;a.pagination.from=b*(c-1)+1,a.pagination.to=Math.min(a.totalHits,b*c)}var d=function(){c(),a.onChange&&a.onChange(a.target,(a.pagination.currentPage-1)*a.pagination.selected.value,a.pagination.selected.value)},e=function(){b(),a.pagination.currentPage=1,d()};a.pageChanged=d,a.pageSizeChanged=e,a.pageSizes=[{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}],a.pagination={selected:a.pageSizes[0],currentPage:1},a.$watch("totalHits",function(){b(),c()})}]);var CRITERIA_ITEM_EVENT={deleted:"event:delete-criteria-item",refresh:"event:refresh-criteria-item"};angular.module("obiba.mica.search").directive("taxonomyPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",lang:"=",onNavigate:"="},templateUrl:"search/views/classifications/taxonomy-panel-template.html"}}]).directive("vocabularyPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",lang:"=",onNavigate:"=",onSelect:"="},templateUrl:"search/views/classifications/vocabulary-panel-template.html"}}]).directive("termPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",term:"=",lang:"=",onSelect:"="},templateUrl:"search/views/classifications/term-panel-template.html"}}]).directive("networksResultTable",["PageUrlService","ngObibaMicaSearch","RqlQueryService",function(a,b,c){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:"search/views/list/networks-search-result-table-template.html",link:function(d){d.options=b.getOptions().networks,d.optionsCols=d.options.networksColumn,d.PageUrlService=a,d.updateCriteria=function(a,b){var e;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(e=b,b="datasets"),c.createCriteriaItem("network","Mica_network","id",a).then(function(a){e?c.createCriteriaItem("dataset","Mica_dataset","className",e).then(function(c){d.onUpdateCriteria(a,b),d.onUpdateCriteria(c,b)}):d.onUpdateCriteria(a,b)})}}}}]).directive("datasetsResultTable",["PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService",function(a,b,c,d){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:"search/views/list/datasets-search-result-table-template.html",link:function(e){e.classNames={},c.get({target:"dataset",taxonomy:"Mica_dataset"}).$promise.then(function(a){e.classNames=a.vocabularies.filter(function(a){return"className"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{})}),e.updateCriteria=function(a,b){d.createCriteriaItem("dataset","Mica_dataset","id",a).then(function(a){e.onUpdateCriteria(a,b)})},e.options=b.getOptions().datasets,e.optionsCols=e.options.datasetsColumn,e.PageUrlService=a}}}]).directive("studiesResultTable",["PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService",function(a,b,c,d){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:"search/views/list/studies-search-result-table-template.html",link:function(e){e.taxonomy={},e.designs={},c.get({target:"study",taxonomy:"Mica_study"}).$promise.then(function(a){e.taxonomy=a,e.designs=a.vocabularies.filter(function(a){return"methods-designs"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{})}),e.hasDatasource=function(a,b){return a&&a.indexOf(b)>-1},e.options=b.getOptions().studies,e.optionsCols=e.options.studiesColumn,e.PageUrlService=a,e.updateCriteria=function(a,b){var c;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(c=b,b="datasets"),d.createCriteriaItem("study","Mica_study","id",a).then(function(a){c?d.createCriteriaItem("dataset","Mica_dataset","className",c).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):e.onUpdateCriteria(a,b)})}}}}]).directive("variablesResultTable",["PageUrlService","ngObibaMicaSearch",function(a,b){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"="},templateUrl:"search/views/list/variables-search-result-table-template.html",link:function(c){c.options=b.getOptions().variables,c.optionsCols=c.options.variablesColumn,c.PageUrlService=a}}}]).directive("coverageResultTable",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",bucket:"=",query:"=",onUpdateCriteria:"="},controller:"CoverageResultTableController",templateUrl:"search/views/coverage/coverage-search-result-table-template.html"}}]).directive("graphicsResult",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",onUpdateCriteria:"="},controller:"GraphicsResultController",templateUrl:"search/views/graphics/graphics-search-result-template.html"}}]).directive("includeReplace",function(){return{require:"ngInclude",link:function(a,b){b.replaceWith(b.children())}}}).directive("scrollToTop",function(){return{restrict:"A",scope:{trigger:"=scrollToTop"},link:function(a,b){a.$watch("trigger",function(){b[0].scrollTop=0})}}}).directive("resultPanel",[function(){return{restrict:"EA",replace:!0,scope:{type:"=",bucket:"=",query:"=",display:"=",result:"=",lang:"=",loading:"=",searchTabsOrder:"=",resultTabsOrder:"=",onTypeChanged:"=",onBucketChanged:"=",onPaginate:"=",onUpdateCriteria:"="},controller:"SearchResultController",templateUrl:"search/views/search-result-panel-template.html"}}]).directive("criteriaRoot",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",onRemove:"=",onRefresh:"="},templateUrl:"search/views/criteria/criteria-root-template.html",link:function(a){a.$on(CRITERIA_ITEM_EVENT.deleted,function(b,c){a.onRemove(c)}),a.$on(CRITERIA_ITEM_EVENT.refresh,function(){a.onRefresh()})}}}]).directive("criteriaTarget",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"="},templateUrl:"search/views/criteria/criteria-target-template.html"}}]).directive("criteriaNode",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"="},controller:"CriterionLogicalController",templateUrl:"search/views/criteria/criteria-node-template.html"}}]).directive("criteriaLeaf",["CriteriaNodeCompileService",function(a){return{restrict:"EA",replace:!0,scope:{item:"=",query:"="},controller:"CriterionLogicalController",link:function(b,c){a.compile(b,c)}}}]).directive("numericCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"NumericCriterionController",templateUrl:"search/views/criteria/criterion-numeric-template.html"}}]).directive("criterionDropdown",["$document","$timeout",function(a,b){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"="},controller:"CriterionDropdownController",templateUrl:"search/views/criteria/criterion-dropdown-template.html",link:function(c,d){var e=function(a){var d=document.querySelector("#"+c.criterion.id.replace(".","-")+"-dropdown").contains(a.target);d||b(function(){c.$apply("closeDropdown()")})};a.on("click",e),d.on("$destroy",function(){a.off("click",e)})}}}]).directive("stringCriterionTerms",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"StringCriterionTermsController",templateUrl:"search/views/criteria/criterion-string-terms-template.html"}}]).directive("matchCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"MatchCriterionTermsController",templateUrl:"search/views/criteria/criterion-match-template.html"}}]).directive("searchResultPagination",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",totalHits:"=",onChange:"="},controller:"SearchResultPaginationController",templateUrl:"search/views/list/search-result-pagination-template.html"}}]).directive("taxonomiesPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomyName:"=",target:"=",onClose:"=",onSelectTerm:"=",taxonomiesShown:"=",lang:"="},controller:"TaxonomiesPanelController",templateUrl:"search/views/classifications/taxonomies-view.html",link:function(a,b){a.closeTaxonomies=function(){b.collapse("hide"),a.onClose()},a.showTaxonomies=function(){b.collapse("show")},b.on("show.bs.collapse",function(){a.taxonomiesShown=!0}),b.on("hide.bs.collapse",function(){a.taxonomiesShown=!1}),a.$watch("taxonomiesShown",function(a){a?b.collapse("show"):b.collapse("hide")})}}}]).directive("classificationsPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",onSelectTerm:"=",lang:"="},controller:"TaxonomiesPanelController",templateUrl:"search/views/classifications/classifications-view.html"}}]),angular.module("obiba.mica.search").config(["$routeProvider",function(a){a.when("/search",{templateUrl:"search/views/search.html",controller:"SearchController",reloadOnSearch:!1}).when("/classifications",{templateUrl:"search/views/classifications.html",controller:"SearchController",reloadOnSearch:!1})}]),angular.module("obiba.mica.graphics",["googlechart","obiba.utils","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("GraphicChartsData",GraphicChartsDataProvider)}]).run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}]),angular.module("obiba.mica.graphics").directive("obibaChart",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"@",chartType:"@",chartAggregationName:"@",chartEntityDto:"@",chartOptionsName:"@",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTableOptions:"=",chartSelectGraphic:"="},templateUrl:"graphics/views/charts-directive.html",controller:"GraphicChartsController"}}]).directive("obibaTable",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"@",chartType:"@",chartAggregationName:"@",chartEntityDto:"@",chartOptionsName:"@",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTableOptions:"=",chartSelectGraphic:"=",chartOrdered:"=",chartNotOrdered:"="},templateUrl:"graphics/views/tables-directive.html",controller:"GraphicChartsController"}}]),angular.module("obiba.mica.graphics").controller("GraphicChartsController",["$rootScope","$scope","$filter","$window","GraphicChartsConfig","GraphicChartsUtils","GraphicChartsData","RqlQueryService","ngObibaMicaUrl",function(a,b,c,d,e,f,g,h,i){b.$watch("chartSelectGraphic",function(a){a&&(b.chartObject={},g.getData(function(a){if(a){var g=f.getArrayByAggregation(b.chartAggregationName,a[b.chartEntityDto]),j=g.map(function(a){return a.participantsNbr?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});b.updateCriteria=function(a,b){h.createCriteriaItem("study","Mica_study",b,a).then(function(a){var b=e.getOptions().entityType,c=e.getOptions().entityIds,f=a.id.split("."),g="mica/repository#/search?type=studies&query="+b+"(in(Mica_"+b+".id,"+c+")),study(in("+f[0]+"."+f[1]+","+f[2].replace(":","%253A")+"))";d.location.href=i.getUrl("BaseUrl")+g})},j&&("Table"===b.chartType?(b.chartObject.ordered=b.chartOrdered,b.chartObject.notOrdered=b.chartNotOrdered,b.chartHeader.length<3?b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]:b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1]),c("translate")(b.chartHeader[2])],b.chartObject.type=b.chartType,b.chartObject.data=j,b.chartObject.vocabulary=b.chartAggregationName,b.chartObject.entries=g):(b.chartHeader.length<3?j.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]):j.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1]),c("translate")(b.chartHeader[2])]),b.chartObject.term=!0,b.chartObject.type=b.chartType,b.chartObject.data=j,b.chartObject.options={backgroundColor:{fill:"transparent"}},angular.extend(b.chartObject.options,b.chartOptions),b.chartObject.options.title=c("translate")(b.chartTitle)+" (N="+a.studyResultDto.totalHits+")"))}}))})}]),angular.module("obiba.mica.graphics").factory("GraphicChartsDataResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQuerySearchResource"),{},{studies:{method:"GET",errorHandler:!0,params:{type:"studies"}}})}]).service("GraphicChartsConfig",function(){var a={options:{entityIds:"NaN",entityType:null,ChartsOptions:{geoChartOptions:{header:["graphics.country","graphics.nbr-studies"],title:"graphics.geo-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#e5edfb","#cfddf5","#b8cbed","#a0b8e2","#88a4d4"]}},studiesDesigns:{header:["graphics.study-design","graphics.nbr-studies","graphics.number-participants"],title:"graphics.study-design-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"},1:{axis:"nbrParticipants"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"},nbrParticipants:{label:"Number of Participants"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}},numberParticipants:{header:["graphics.number-participants","graphics.nbr-studies"],title:"graphics.number-participants-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"],pieSliceTextStyle:{color:"#000000"}}},biologicalSamples:{header:["graphics.bio-samples","graphics.nbr-studies"],title:"graphics.bio-samples-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"],pieSliceTextStyle:{color:"#000000"}}}}}};return a.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a.options&&(a.options[c]=b[c])})},a.getOptions=function(){return angular.copy(a.options)},a}).service("GraphicChartsUtils",[function(){this.getArrayByAggregation=function(a,b){var c=[];return b?(angular.forEach(b.aggs,function(b){if(b.aggregation===a){var d=0;if(b["obiba.mica.RangeAggregationResultDto.ranges"])angular.forEach(b["obiba.mica.RangeAggregationResultDto.ranges"],function(a){a.count&&(c[d]={title:a.title,value:a.count,key:a.key},d++)});else if("methods-designs"===b.aggregation){var e=0;angular.forEach(b["obiba.mica.TermsAggregationResultDto.terms"],function(a){angular.forEach(a.aggs,function(a){"numberOfParticipants-participant-number"===a.aggregation&&(e=a["obiba.mica.StatsAggregationResultDto.stats"].data.sum)}),a.count&&(c[d]={title:a.title,value:a.count,participantsNbr:e,key:a.key},d++)})}else angular.forEach(b["obiba.mica.TermsAggregationResultDto.terms"],function(a){a.count&&(c[d]={title:a.title,value:a.count,key:a.key},d++)})}}),c):c}}]).service("GraphicChartsQuery",["RqlQueryService","RqlQueryUtils","LocalizedValues",function(a,b,c){this.queryDtoBuilder=function(d,e){var f;d&&"NaN"!==d||(f="study(exists(Mica_study.id))"),e&&"NaN"!==d&&(f=e+"(in(Mica_"+e+".id,("+d+")))");var g=angular.copy((new RqlParser).parse(f));b.addLocaleQuery(g,c.getLocal());var h=(new RqlQuery).serializeArgs(g.args);return a.prepareGraphicsQuery(h,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-designs"])}}]),angular.module("obiba.mica.localized",["obiba.notification","pascalprecht.translate","templates-ngObibaMica"]),angular.module("obiba.mica.localized").directive("localized",[function(){return{restrict:"AE",scope:{value:"=",lang:"="},template:'<span ng-repeat="localizedValue in value | filter:{lang:lang}">{{localizedValue.value}}</span>'}}]).directive("localizedInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@"},templateUrl:"localized/localized-input-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedInputGroup",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",remove:"="},templateUrl:"localized/localized-input-group-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedTextarea",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",rows:"@"},templateUrl:"localized/localized-textarea-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]),angular.module("obiba.mica.localized").service("LocalizedValues",function(){this["for"]=function(a,b,c,d){if(angular.isArray(a)){var e=a.filter(function(a){return a[c]===b});return e&&e.length>0?e[0][d]:e[0][d]}return""},this.forLocale=function(a,b){return this["for"](a,b,"locale","text")},this.forLang=function(a,b){return this["for"](a,b,"lang","value")},this.getLocal=function(){return"en"}}),angular.module("templates-ngObibaMica",["access/views/data-access-request-form.html","access/views/data-access-request-histroy-view.html","access/views/data-access-request-list.html","access/views/data-access-request-profile-user-modal.html","access/views/data-access-request-submitted-modal.html","access/views/data-access-request-validation-modal.html","access/views/data-access-request-view.html","attachment/attachment-input-template.html","attachment/attachment-list-template.html","graphics/views/charts-directive.html","graphics/views/tables-directive.html","localized/localized-input-group-template.html","localized/localized-input-template.html","localized/localized-textarea-template.html","search/views/classifications.html","search/views/classifications/classifications-view.html","search/views/classifications/taxonomies-view.html","search/views/classifications/taxonomy-panel-template.html","search/views/classifications/taxonomy-template.html","search/views/classifications/term-panel-template.html","search/views/classifications/vocabulary-panel-template.html","search/views/coverage/coverage-search-result-table-template.html","search/views/criteria/criteria-node-template.html","search/views/criteria/criteria-root-template.html","search/views/criteria/criteria-target-template.html","search/views/criteria/criterion-dropdown-template.html","search/views/criteria/criterion-header-template.html","search/views/criteria/criterion-match-template.html","search/views/criteria/criterion-numeric-template.html","search/views/criteria/criterion-string-terms-template.html","search/views/criteria/target-template.html","search/views/graphics/graphics-search-result-template.html","search/views/list/datasets-search-result-table-template.html","search/views/list/networks-search-result-table-template.html","search/views/list/pagination-template.html","search/views/list/search-result-pagination-template.html","search/views/list/studies-search-result-table-template.html","search/views/list/variables-search-result-table-template.html","search/views/search-result-coverage-template.html","search/views/search-result-graphics-template.html","search/views/search-result-list-dataset-template.html","search/views/search-result-list-network-template.html","search/views/search-result-list-study-template.html","search/views/search-result-list-template.html","search/views/search-result-list-variable-template.html","search/views/search-result-panel-template.html","search/views/search.html"]),angular.module("access/views/data-access-request-form.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-form.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <div class="pull-right">\n      <a ng-click="cancel()" type="button" class="btn btn-default">\n        <span translate>cancel</span>\n      </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n      <a ng-click="validate()" type="button" class="btn btn-info">\n        <span translate>validate</span>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <form name="form.requestForm" ng-submit="submit(form.requestForm)">\n      <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema" required="true"></div>\n      <h2>{{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}</h2>\n      <p>{{config.documentsSectionHelpText || \'data-access-request.documents-help\' | translate}}</p>\n      <div class="form-group">\n        <attachment-input files="dataAccessRequest.attachments" multiple="true"></attachment-input>\n      </div>\n    </form>\n  </div>\n\n</div>\n')}]),angular.module("access/views/data-access-request-histroy-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-histroy-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<table id="data-access-request-history" class="table table-striped">\n  <thead>\n  <tr>\n    <th class="status-icon"></th>\n    <th translate>status</th>\n    <th translate>changed-by</th>\n    <th translate>Changed On</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="status in dataAccessRequest.statusChangeHistory"\n    ng-init="info = getStatusHistoryInfo[getStatusHistoryInfoId(status)]">\n    <td><span><i class="{{info.icon}} hoffset"></i></span></td>\n    <td>{{info.msg}}</span></span></td>\n    <td>{{userProfileService.getFullName(status.profile) || status.author}}</td>\n    <td><span>{{status.changedOn | fromNow}}</span></td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("access/views/data-access-request-list.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-list.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div id="data-access-request-list">\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <a ng-href="#/data-access-request/new" class="btn btn-info">\n    <i class="fa fa-plus"></i> <span>{{config.newRequestButtonCaption || \'data-access-request.add\' | translate}}</span>\n  </a>\n\n  <p class="help-block" ng-if="requests.length == 0 && !loading">\n    <span translate>data-access-request.none</span>\n  </p>\n\n  <p ng-if="loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search"><i\n              class="glyphicon glyphicon-search"></i></span>\n          <input ng-model="searchText" type="text" class="form-control"\n              aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-2">\n        <div class="input-group">\n          <ui-select id="status-select" theme="bootstrap"\n              ng-model="searchStatus.filter" reset-search-input="true">\n            <ui-select-match allow-clear="true"\n                placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n              <span ng-bind-html="$select.selected"></span>\n            </ui-select-match>\n            <ui-select-choices repeat="data in REQUEST_STATUS">\n              {{data}}\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th>ID</th>\n          <th translate ng-if="showApplicant">data-access-request.applicant</th>\n          <th translate>data-access-request.title</th>\n          <th translate>data-access-request.lastUpdate</th>\n          <th translate>data-access-request.submissionDate</th>\n          <th translate>data-access-request.status</th>\n          <th translate>actions</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr\n            dir-paginate="request in requests | filter:{status: searchStatus.filter} | filter:searchText | itemsPerPage: 20">\n          <td>\n            <a ng-href="#/data-access-request/{{request.id}}"\n                ng-if="actions.canView(request)" translate>{{request.id}}</a>\n            <span ng-if="!actions.canView(request)">{{request.id}}</span>\n          </td>\n          <td ng-if="showApplicant">\n            <span ng-if="actions.canViewProfile(\'mica-user\')">\n         {{getFullName(request.profile) || request.applicant}}\n            </span>\n            <a href ng-click="userProfile(request.profile)"\n                ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n              {{getFullName(request.profile) ||\n              request.applicant}}\n            </a>\n          </td>\n          <td>\n            {{request.title}}\n          </td>\n          <td>\n            {{(request.timestamps.lastUpdate || request.timestamps.created) |\n            fromNow}}\n          </td>\n          <td>\n            <span ng-if="request.submissionDate">{{request.submissionDate | fromNow}}</span>\n          </td>\n          <td>\n            {{request.status | translate}}\n          </td>\n          <td>\n            <ul class="list-inline">\n              <li ng-if="actions.canEdit(request)">\n                <a ng-href="#/data-access-request/{{request.id}}/edit"\n                    title="{{\'edit\' | translate}}"><i class="fa fa-pencil"></i></a>\n              </li>\n              <li>\n                <a ng-if="actions.canDelete(request)"\n                    ng-click="deleteRequest(request)"\n                    title="{{\'delete\' | translate}}"><i\n                    class="fa fa-trash-o"></i></a>\n              </li>\n            </ul>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n\n</div>\n');
}]),angular.module("access/views/data-access-request-profile-user-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-profile-user-modal.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true"\n      ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <div>\n      <label class="control-label">\n        {{\'data-access-request.profile.name\' | translate}}\n      </label> :\n      <span>\n        {{getFullName(applicant)}}\n      </span>\n    </div>\n\n    <div>\n      <label class="control-label">\n        {{\'data-access-request.profile.email\' | translate}}\n      </label> :\n      <span>\n        {{getProfileEmail(applicant)}}\n      </span>\n    </div>\n\n    <div\n      ng-repeat="attribute in applicant.attributes | filterProfileAttributes">\n      <label  class="control-label">\n        {{attribute.key}}\n      </label> :\n      <span >{{attribute.value}}</span>\n    </div>\n    <a  class="btn btn-default" href="mailto:{{getProfileEmail(applicant)}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4"\n      ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-submitted-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-submitted-modal.html",'<?php\n/**\n * @file\n * Code for the obiba_mica_data_access_request modules.\n */\n\n?>\n<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.submit-confirmation.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p>{{\'data-access-request.submit-confirmation.message\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-validation-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-validation-modal.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="form.requestForm.$valid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!form.requestForm.$valid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <p class="help-block pull-left"><span translate>created-by</span>\n       <span ng-if="actions.canViewProfile(\'mica-user\')">\n         {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}\n      </span>\n      <a href ng-click="userProfile(dataAccessRequest.profile)"\n          ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n        {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}\n      </a>,\n      <span>{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n      <span class="label label-success">{{dataAccessRequest.status}}</span></p>\n\n    <div class="pull-right">\n      <a ng-click="submit()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)"\n        class="btn btn-info" translate>submit\n      </a>\n      <a ng-click="reopen()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)"\n        class="btn btn-info" translate>reopen\n      </a>\n      <a ng-click="review()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)"\n        class="btn btn-info" translate>review\n      </a>\n      <a ng-click="approve()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)"\n        class="btn btn-info" translate>approve\n      </a>\n      <a ng-click="reject()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)"\n        class="btn btn-info" translate>reject\n      </a>\n      <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit"\n        ng-if="actions.canEdit(dataAccessRequest)"\n        class="btn btn-primary" title="{{\'edit\' | translate}}">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n      <a target="_self" href="{{requestDownloadUrl}}" class="btn btn-default">\n        <i class="glyphicon glyphicon-download-alt"></i> <span>{{config.downloadButtonCaption || \'download\' | translate}}</span>\n      </a>\n      <a ng-click="delete()"\n        ng-if="actions.canDelete(dataAccessRequest)"\n        class="btn btn-danger" title="{{\'delete\' | translate}}">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <uib-tabset class="voffset5">\n      <uib-tab ng-click="selectTab(\'form\')" heading="{{\'data-access-request.form\' | translate}}">\n        <form id="request-form" name="forms.requestForm">\n          <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema"></div>\n        </form>\n        <h2>{{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}</h2>\n\n        <p ng-if="dataAccessRequest.attachments.length == 0" translate>\n          data-access-request.no-documents\n        </p>\n\n        <attachment-list files="dataAccessRequest.attachments"\n            href-builder="getDownloadHref(attachments, id)"></attachment-list>\n      </uib-tab>\n      <uib-tab ng-if="config.commentsEnabled" ng-click="selectTab(\'comments\')" heading="{{\'data-access-request.comments\' | translate}}">\n        <obiba-comments comments="form.comments" on-update="updateComment" on-delete="deleteComment" name-resolver="userProfileService.getFullName" edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n        <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n      </uib-tab>\n      <uib-tab ng-click="selectTab(\'history\')" heading="{{\'data-access-request.history\' | translate}}">\n        <div ng-include="\'access/views/data-access-request-histroy-view.html\'"></div>\n      </uib-tab>\n    </uib-tabset>\n  </div>\n\n</div>\n')}]),angular.module("attachment/attachment-input-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-input-template.html",'<button type="button" class="btn btn-primary btn-xs" aria-hidden="true" ngf-select ngf-change="onFileSelect($files)" translate>file.upload.button</button>\n\n<table ng-show="files.length" class="table table-striped">\n  <tbody>\n  <tr ng-repeat="file in files">\n    <td>\n      {{file.fileName}}\n      <uib-progressbar ng-show="file.showProgressBar" class="progress-striped" value="file.progress">\n        {{file.progress}}%\n      </uib-progressbar>\n    </td>\n    <td>\n      {{file.size | bytes}}\n    </td>\n    <td>\n      <a ng-show="file.id" ng-click="deleteFile(file.id)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n      <a ng-show="file.tempId" ng-click="deleteTempFile(file.tempId)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("attachment/attachment-list-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-list-template.html",'<table class="table table-bordered table-striped" ng-show="attachments.length">\n  <tbody>\n  <tr ng-repeat="attachment in attachments">\n    <th>\n      <a target="_self" ng-href="{{attachment.href}}"\n        download="{{attachment.fileName}}">{{attachment.fileName}}\n      </a>\n    </th>\n    <td>\n      {{attachment.size | bytes}}\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("graphics/views/charts-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/charts-directive.html",'<div>\n  <div google-chart chart="chartObject" style="min-height:350px; width:100%;">\n  </div>\n</div>\n')}]),angular.module("graphics/views/tables-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/tables-directive.html",'<div>\n    <div style="margin:25px;">\n        <table class="table table-striped table-bordered">\n            <thead>\n            <th ng-repeat="header in chartObject.header">{{header}}</th>\n            </thead>\n            <tr ng-show="chartObject.ordered" ng-repeat="row in chartObject.entries | orderBy:\'-this[1]\'">\n                <td>{{row.title}}</td>\n                <td><a href ng-click="updateCriteria(row.key, chartObject.vocabulary)">{{row.value}}</a></td>\n                <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n            </tr>\n            <tr ng-show="chartObject.notOrdered" ng-repeat="row in chartObject.entries">\n                <td>{{row.title}}</td>\n                <td><a href ng-click="updateCriteria(row.key, chartObject.vocabulary)">{{row.value}}</a></td>\n                <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n            </tr>\n            </tbody>\n\n        </table>\n    </div>\n</div>\n')}]),angular.module("localized/localized-input-group-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-group-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <div class="input-group">\n    <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <span class="input-group-btn" ng-show="remove">\n    <button class="btn btn-default" type="button" ng-click="remove(model)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n  </span>\n  </div>\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-input-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-textarea-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-textarea-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <textarea ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" rows="{{rows ? rows : 5}}" class="form-control" id="{{fieldName}}" name="{{fieldName}}" form-server-error ng-disabled="disabled" ng-required="required"></textarea>\n\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>')}]),angular.module("search/views/classifications.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications.html",'<div>\n  <div ng-if="classificationsHeaderTemplateUrl" ng-include="classificationsHeaderTemplateUrl"></div>\n\n  <obiba-alert id="SearchController"></obiba-alert>\n\n  <a href class="btn btn-sm btn-success" ng-click="goToSearch()">\n    <i class="fa fa-chevron-left"></i>\n    <span translate>search.back</span>\n  </a>\n\n  <!-- Lang tabs -->\n  <ul class="nav nav-tabs" role="tablist" ng-if="tabs && tabs.length>1">\n    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab"\n      ng-click="setLocale(tab)">{{\'language.\' + tab | translate}}</a></li>\n  </ul>\n\n  <!-- Search criteria region -->\n  <div class="panel panel-default voffset2" ng-if="search.criteria.children && search.criteria.children.length>0">\n    <div class="panel-body">\n      <table style="border:none;">\n        <tbody>\n        <tr>\n          <td>\n            <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n          </td>\n          <td>\n            <div criteria-root item="search.criteria" query="search.query" on-remove="removeCriteriaItem"\n              on-refresh="refreshQuery"></div>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n  <!-- Classifications region -->\n  <div class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n    <uib-tabset type="pills" ng-if="taxonomyTabsOrder.length>1" class="voffset2">\n      <uib-tab ng-repeat="target in taxonomyTabsOrder" heading="{{\'taxonomy.target.\' + target | translate}}">\n        <classifications-panel target="target" on-select-term="onSelectTerm" lang="lang"></classifications-panel>\n      </uib-tab>\n    </uib-tabset>\n    <classifications-panel  ng-if="taxonomyTabsOrder.length === 1" target="taxonomyTabsOrder[0]" on-select-term="onSelectTerm" lang="lang"></classifications-panel>\n  </div>\n\n</div>')}]),angular.module("search/views/classifications/classifications-view.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/classifications-view.html",'<div class="voffset2">\n  <div>\n    <ol class="breadcrumb">\n      <li ng-if="!taxonomies.taxonomy">\n        {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n      </li>\n      <li ng-if="taxonomies.taxonomy">\n        <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' |\n          translate}}</a>\n      </li>\n      <li ng-if="taxonomies.taxonomy">\n        <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="!taxonomies.vocabulary && label.locale === lang">\n          {{label.text}}\n        </span>\n        <a href ng-click="navigateTaxonomy(taxonomies.taxonomy)" ng-if="taxonomies.vocabulary">\n          <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n            {{label.text}}\n          </span>\n        </a>\n      </li>\n      <li ng-if="taxonomies.vocabulary">\n        <span ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </span>\n      </li>\n    </ol>\n  </div>\n\n  <div ng-if="taxonomies.search.active" class="loading"></div>\n\n  <div ng-if="!taxonomies.taxonomy">\n    <div ng-repeat="group in taxonomyGroups">\n      <h3 ng-if="group.title">{{group.title}}</h3>\n      <p class="help-block" ng-if="group.description">{{group.description}}</p>\n      <div ng-if="!taxonomies.taxonomy">\n        <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n          <div class="col-md-4">\n            <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang"\n              on-navigate="navigateTaxonomy"></div>\n          </div>\n          <div class="col-md-4">\n            <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang"\n              on-navigate="navigateTaxonomy"></div>\n          </div>\n          <div class="col-md-4">\n            <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang"\n              on-navigate="navigateTaxonomy"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n    <h3 ng-repeat="label in taxonomies.taxonomy.title"\n      ng-if="label.locale === lang">\n      {{label.text}}\n    </h3>\n\n    <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n      {{label.text}}\n    </p>\n\n    <div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n      <div class="col-md-4">\n        <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n      <div class="col-md-4">\n        <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 1]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n      <div class="col-md-4">\n        <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 2]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n    </div>\n  </div>\n\n  <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && !taxonomies.term">\n    <h3 ng-repeat="label in taxonomies.vocabulary.title"\n      ng-if="label.locale === lang">\n      {{label.text}}\n    </h3>\n\n    <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description"\n      ng-if="label.locale === lang">\n      {{label.text}}\n    </p>\n\n    <div ng-repeat="term in taxonomies.vocabulary.terms" ng-if="$index % 3 == 0" class="row">\n      <div class="col-md-4">\n        <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n      <div class="col-md-4">\n        <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 1]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n      <div class="col-md-4">\n        <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 2]"\n          lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n      </div>\n    </div>\n  </div>\n\n  <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && taxonomies.term">\n    <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n      {{label.text}}\n    </h5>\n    <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n      <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceIds\'"></span>\n      <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceIds\'"></span>\n    </p>\n    <div>\n      <a href class="btn btn-default btn-xs"\n        ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, taxonomies.term)">\n        <i class="fa fa-plus-circle"></i>\n        <span translate>add-query</span>\n      </a>\n    </div>\n  </div>\n\n</div>\n')}]),angular.module("search/views/classifications/taxonomies-view.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomies-view.html",'<div class="collapse">\n  <div class="voffset2">\n    <div class="panel panel-default">\n      <div class="panel-heading">\n        <div class="row">\n          <div class="col-md-8">\n            <ol class="breadcrumb no-margin no-padding pull-left">\n              <li ng-if="!taxonomies.taxonomy">\n                {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n              </li>\n              <li ng-if="taxonomies.taxonomy">\n                <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' |\n                  translate}}</a>\n              </li>\n              <li ng-if="taxonomies.taxonomy">\n            <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n              {{label.text}}\n            </span>\n              </li>\n            </ol>\n          </div>\n          <div class="col-md-4">\n        <span ng-click="closeTaxonomies()" title="{{\'close\' | translate}}" class="pull-right"><i\n            class="fa fa-close"></i></span>\n          </div>\n        </div>\n      </div>\n      <div class="panel-body">\n        <div ng-if="taxonomies.search.active" class="loading"></div>\n\n        <div ng-if="!taxonomies.taxonomy">\n          <div ng-repeat="group in taxonomyGroups">\n            <h4 ng-if="group.title">{{group.title}}</h4>\n            <p class="help-block" ng-if="group.description">{{group.description}}</p>\n            <div ng-if="!taxonomies.taxonomy">\n              <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n                <div class="col-md-4">\n                  <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang"\n                      on-navigate="navigateTaxonomy"></div>\n                </div>\n                <div class="col-md-4">\n                  <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang"\n                      on-navigate="navigateTaxonomy"></div>\n                </div>\n                <div class="col-md-4">\n                  <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang"\n                      on-navigate="navigateTaxonomy"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div ng-if="taxonomies.taxonomy">\n          <div class="row">\n            <div class="col-md-4 height3" scroll-to-top="taxonomies.taxonomy">\n              <h5 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n                {{label.text}}\n              </h5>\n              <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n                {{label.text}}\n              </p>\n              <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.taxonomy.vocabularies">\n                <li ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies"\n                    class="{{taxonomies.vocabulary.name === vocabulary.name ? \'active\' : \'\'}}">\n                  <a href ng-click="navigateTaxonomy(taxonomies.taxonomy, vocabulary)">\n                <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n                  {{label.text}}\n                </span>\n                <span ng-if="!vocabulary.title">\n                  {{vocabulary.name}}\n                </span>\n                  </a>\n                </li>\n              </ul>\n            </div>\n            <div class="col-md-4 height3" scroll-to-top="taxonomies.vocabulary">\n              <div ng-if="taxonomies.vocabulary">\n                <h5 ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n                  {{label.text}}\n                </h5>\n                <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description"\n                    ng-if="label.locale === lang">\n                  {{label.text}}\n                </p>\n                <div>\n                  <a href class="btn btn-default btn-xs"\n                      ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary)">\n                    <i class="fa fa-plus-circle"></i>\n                    <span translate>add-query</span>\n                  </a>\n                </div>\n                <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.vocabulary.terms">\n                  <li ng-repeat="term in taxonomies.vocabulary.terms"\n                      class="{{taxonomies.term.name === term.name ? \'active\' : \'\'}}">\n                    <a href ng-click="navigateTaxonomy(taxonomies.taxonomy, taxonomies.vocabulary, term)">\n                <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n                  {{label.text}}\n                </span>\n                <span ng-if="!term.title">\n                  {{term.name}}\n                </span>\n                    </a>\n                  </li>\n                </ul>\n              </div>\n            </div>\n            <div class="col-md-4 height3" scroll-to-top="taxonomies.term">\n              <div ng-if="taxonomies.term">\n                <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n                  {{label.text}}\n                </h5>\n                <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n                  <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceIds\'"></span>\n                  <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceIds\'"></span>\n                </p>\n                <div>\n                  <a href class="btn btn-default btn-xs"\n                      ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, taxonomies.term)">\n                    <i class="fa fa-plus-circle"></i>\n                    <span translate>add-query</span>\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="taxonomy">\n    <div class="panel-heading">\n      <div ng-repeat="label in taxonomy.title" ng-if="label.locale === lang">\n        <a href ng-click="onNavigate(taxonomy)">{{label.text}}</a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-template.html",'<div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n  <div class="col-md-4">\n    <div vocabulary-panel taxonomy="taxonomies.taxonomy.vocabularies[$index]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 1]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 2]"></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/term-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/term-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="term">\n    <div class="panel-heading">\n      <div ng-repeat="label in term.title" ng-if="label.locale === lang">\n        {{label.text}}\n        <small>\n          <a href ng-click="onSelect(target, taxonomy, vocabulary, term)">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </a>\n        </small>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in term.description" ng-if="label.locale === lang">\n        <span ng-bind-html="label.text | dceDescription" ng-if="vocabulary.name === \'dceIds\'"></span>\n        <span ng-bind-html="label.text" ng-if="vocabulary.name !== \'dceIds\'"></span>\n      </div>\n      <div ng-if="!term.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/vocabulary-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/vocabulary-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="vocabulary">\n    <div class="panel-heading">\n      <div ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n        <a href ng-click="onNavigate(taxonomy, vocabulary)" ng-if="vocabulary.terms">{{label.text}}</a>\n        <span ng-if="!vocabulary.terms">{{label.text}}</span>\n        <a href ng-click="onSelect(target, taxonomy, vocabulary)">\n          <small ng-if="vocabulary.terms"><i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i></small>\n          <small ng-if="!vocabulary.terms"><i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i></small>\n        </a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in vocabulary.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </div>\n      <div ng-if="!vocabulary.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>');
}]),angular.module("search/views/coverage/coverage-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/coverage/coverage-search-result-table-template.html",'<div>\n\n  <div ng-if="hasVariableTarget()">\n    <ul class="nav nav-pills pull-left">\n      <li ng-if="groupByOptions.canShowStudy()"\n        ng-class="{\'active\': bucket === BUCKET_TYPES.STUDY || bucket === BUCKET_TYPES.DCE}">\n        <a href ng-click="selectBucket(groupByOptions.studyBucket())" translate>{{groupByOptions.studyTitle()}}</a>\n      </li>\n      <li ng-if="groupByOptions.canShowDataset()"\n        ng-class="{\'active\': bucket === BUCKET_TYPES.DATASET || bucket === BUCKET_TYPES.DATASCHEMA}">\n        <a href ng-click="selectBucket(groupByOptions.datasetBucket())" translate>{{groupByOptions.datasetTitle()}}</a>\n      </li>\n      <li ng-if="groupByOptions.canShowNetwork()" ng-class="{\'active\': bucket === BUCKET_TYPES.NETWORK}">\n        <a href ng-click="selectBucket(BUCKET_TYPES.NETWORK)" translate>search.coverage-buckets.network</a>\n      </li>\n    </ul>\n\n    <div class="pull-right">\n      <a ng-if="hasSelected()" href class="btn btn-default" ng-click="updateFilterCriteria()">\n        <i class="fa fa-filter"></i> {{\'search.filter\' | translate}}\n      </a>\n      <a ng-if="table.taxonomyHeaders.length > 0" target="_self" class="btn btn-info btn-responsive"\n        ng-href="{{downloadUrl()}}">\n        <i class="fa fa-download"></i> {{\'download\' | translate}}\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <div class="voffset2" ng-if="groupByOptions.canShowDce(bucket)">\n      <label class="checkbox-inline">\n        <input type="checkbox" ng-model="bucketSelection.dceBucketSelected">\n        <span translate>search.coverage-buckets.dce</span>\n      </label>\n    </div>\n\n    <div class="voffset2" ng-if="groupByOptions.canShowDatasetStudyDataschema(bucket)">\n      <label class="radio-inline">\n        <input type="radio" ng-model="bucketSelection.datasetBucketSelected" ng-value="true">\n        <span translate>search.coverage-buckets.dataset</span>\n      </label>\n      <label class="radio-inline">\n        <input type="radio" ng-model="bucketSelection.datasetBucketSelected" ng-value="false">\n        <span translate>search.coverage-buckets.dataschema</span>\n      </label>\n    </div>\n  </div>\n\n  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders">\n    <span ng-if="!hasVariableTarget()" translate>search.no-coverage</span>\n    <span ng-if="hasVariableTarget()" translate>search.no-results</span>\n  </p>\n\n  <div ng-if="loading" class="loading"></div>\n\n  <div class="table-responsive" ng-if="table.taxonomyHeaders.length > 0">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th rowspan="2" width="20px"></th>\n        <th rowspan="{{bucket === BUCKET_TYPES.DCE ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>\n          {{\'search.coverage-buckets.\' + bucket}}\n        </th>\n        <th ng-repeat="header in table.vocabularyHeaders" colspan="{{header.termsCount}}">\n          <span\n            uib-popover="{{header.entity.descriptions[0].value}}"\n            popover-title="{{header.entity.titles[0].value}}"\n            popover-placement="bottom"\n            popover-trigger="mouseenter">\n          {{header.entity.titles[0].value}}\n            </span>\n        </th>\n      </tr>\n      <tr>\n        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.study</th>\n        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.population</th>\n        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.dce</th>\n        <th ng-repeat="header in table.termHeaders">\n          <span\n            uib-popover="{{header.entity.descriptions[0].value}}"\n            popover-title="{{header.entity.titles[0].value}}"\n            popover-placement="bottom"\n            popover-trigger="mouseenter">\n          {{header.entity.titles[0].value}}\n            </span>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in table.rows" ng-if="showMissing || table.termHeaders.length == keys(row.hits).length">\n        <td><input type="checkbox" ng-model="row.selected"></td>\n        <td ng-repeat="col in table.cols.ids[row.value]">\n          <a ng-if="col.rowSpan > 0" href="{{col.url ? col.url : \'\'}}"\n            uib-popover-html="col.description === col.title ? null : col.description"\n            popover-title="{{col.title}}"\n            popover-placement="bottom"\n            popover-trigger="mouseenter">{{col.title}}</a>\n          <table style="border:none; width: 100%" ng-if="col.start">\n            <tbody>\n            <tr>\n              <td>\n                <small class="help-block no-margin">\n                  {{col.start}}\n                </small>\n              </td>\n              <td>&nbsp;</td>\n              <td align="right">\n                <small class="help-block no-margin">\n                  {{col.end ? col.end : \'...\'}}\n                </small>\n              </td>\n            </tr>\n            <tr>\n              <td colspan="3">\n                <div class="progress no-margin">\n                  <div class="progress-bar progress-bar-transparent" role="progressbar"\n                    aria-valuenow="{{col.start}}" aria-valuemin="{{col.min}}"\n                    aria-valuemax="{{col.start}}" style="{{\'width: \' + col.progressStart + \'%\'}}">\n                  </div>\n                  <div class="progress-bar progress-bar-info" role="progressbar"\n                    aria-valuenow="{{col.current}}" aria-valuemin="{{col.start}}"\n                    aria-valuemax="{{col.end ? col.end : col.current}}" style="{{\'width: \' + col.progress + \'%\'}}">\n                  </div>\n                </div>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </td>\n        <td ng-repeat="h in table.termHeaders">\n          <a href ng-click="updateCriteria(row.value, h, $index, \'variables\')"><span class="label label-info"\n            ng-if="row.hits[$index]">{{row.hits[$index]}}</span></a>\n          <span ng-if="!row.hits[$index]">0</span>\n        </td>\n      </tr>\n      </tbody>\n      <tfoot>\n      <tr>\n        <th></th>\n        <th colspan="{{table.cols.colSpan}}" translate>all</th>\n        <th ng-repeat="header in table.termHeaders" title="{{header.entity.descriptions[0].value}}">\n          <a href ng-click="updateCriteria(null, header, $index, \'variables\')">{{header.hits}}</a>\n        </th>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n\n  <!--<pre>-->\n  <!--{{table.cols | json}}-->\n  <!--</pre>-->\n</div>')}]),angular.module("search/views/criteria/criteria-node-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-node-template.html",'<span>\n  <span ng-if="item.children.length > 0">\n    <criteria-leaf item="item.children[0]" parent-type="$parent.item.type" query="query"></criteria-leaf>\n\n    <div class="btn-group voffset1" uib-dropdown is-open="status.isopen">\n      <button type="button" class="btn btn-default btn-xs" uib-dropdown-toggle ng-disabled="disabled">\n        {{item.type | translate}} <span class="caret"></span>\n      </button>\n      <ul uib-dropdown-menu role="menu" aria-labelledby="single-button">\n        <li role="menuitem" ng-if="item.type !== \'or\'"><a href ng-click="updateLogical(\'or\')" translate>or</a></li>\n        <li role="menuitem" ng-if="item.type !== \'and\'"><a href ng-click="updateLogical(\'and\')" translate>and</a></li>\n        <li role="menuitem" ng-if="item.type !== \'nor\'"><a href ng-click="updateLogical(\'nor\')" translate>nor</a></li>\n        <li role="menuitem" ng-if="item.type !== \'nand\'"><a href ng-click="updateLogical(\'nand\')" translate>nand</a></li>\n      </ul>\n    </div>\n    <criteria-leaf item="item.children[1]" parent-type="$parent.item.type" query="query"></criteria-leaf>\n\n  </span>\n  <span ng-if="item.children.length === 0">\n    <criteria-leaf item="item" parent-type="item.parent.type" query="query"></criteria-leaf>\n  </span>\n</span>')}]),angular.module("search/views/criteria/criteria-root-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-root-template.html",'<div class="form-inline hoffset2">\n  <div ng-repeat="child in item.children" class="inline">\n    <div class="inline hoffset2" ng-if="$index>0">+</div>\n    <criteria-target item="child" query="$parent.query" class="inline"></criteria-target>\n  </div>\n</div>\n')}]),angular.module("search/views/criteria/criteria-target-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-target-template.html",'<div>\n  <div class="form-group" title="{{\'search.\' + item.target + \'-where\' | translate}}">\n    <i class="{{\'i-obiba-x-large i-obiba-\' + item.target + \' color-\' + item.target}}">&nbsp;</i>\n  </div>\n  <criteria-node item="child" query="$parent.query" ng-repeat="child in item.children"></criteria-node>\n</div>')}]),angular.module("search/views/criteria/criterion-dropdown-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-dropdown-template.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown" class="{{\'btn-group voffset1 btn-\' + criterion.target}}" ng-class=\'{open: state.open}\'\n     ng-keyup="onKeyup($event)">\n\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}"\n    ng-click="openDropdown()"\n    title="{{localizeCriterion()}}">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}"\n          popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}"\n          popover-placement="bottom"\n          popover-trigger="mouseenter">\n    <i class="fa fa-info-circle"> </i>\n  </span>\n    <span>\n    {{truncate(localizeCriterion())}}\n    </span>\n    <span class=\'fa fa-caret-down\'></span>\n  </button>\n  <button class=\'btn btn-xs btn-default\' ng-click=\'remove(criterion.id)\'>\n    <span class=\'fa fa-times\'></span>\n  </button>\n\n  <match-criterion ng-if="RqlQueryUtils.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n                  state="state"></match-criterion>\n\n  <string-criterion-terms\n    ng-if="RqlQueryUtils.isTermsVocabulary(criterion.vocabulary) || RqlQueryUtils.isRangeVocabulary(criterion.vocabulary)"\n    criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="RqlQueryUtils.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n    state="state"></numeric-criterion>\n\n</div>\n')}]),angular.module("search/views/criteria/criterion-header-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-header-template.html",'<li class="criteria-list-item">\n  <label uib-popover="{{localize(criterion.vocabulary.description)}}"\n         popover-title="{{localize(criterion.vocabulary.title)}}"\n         popover-placement="bottom"\n         popover-trigger="mouseenter">\n    {{localize(criterion.vocabulary.title)}}\n  </label>\n  <span class="pull-right" title="{{\'search.close-and-search\' | translate}}"><a href ng-click="$parent.$parent.closeDropdown()"><i class="fa fa-play-circle-o"></i></a></span>\n</li>\n<li class=\'divider\'></li>\n')}]),angular.module("search/views/criteria/criterion-match-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-match-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="criteria-list-item">\n    <form novalidate>\n      <div  >\n        <input class="form-control" id="{{criterion.vocabulary.name}}-match"\n               ng-model="match"\n               ng-change="update()"\n               placeholder="{{\'search.match.placeholder\' | translate}}">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/criterion-numeric-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-numeric-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label>\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="false">\n          {{\'any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label>\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="true">\n          {{\'none\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="!selectMissing" class=\'divider\'></li>\n  <li ng-show="!selectMissing" class="btn-group criteria-list-item">\n    <form novalidate>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-from" translate>from</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-from" placeholder="{{min}}" ng-model="from" style="width:150px">\n      </div>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-to" translate>to</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-to" placeholder="{{max}}" ng-model="to" style="width:150px">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/criterion-string-terms-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-string-terms-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label>\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.EXISTS}}">\n          {{\'any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label>\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.MISSING}}">\n          {{\'none\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label>\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.IN}}">\n          {{\'in\' | translate}}\n        </label>\n      </li>\n      <li ng-show="criterion.vocabulary.repeatable">\n        <label>\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.CONTAINS}}">\n          {{\'contains\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="isInFilter() || isContainsFilter()" class=\'divider\'></li>\n  <li class="criteria-list-item" ng-show="state.loading">\n    <p class="voffset2 loading">\n    </p>\n  </li>\n  <li ng-show="isInFilter() || isContainsFilter()">\n    <ul ng-show="!state.loading" class="no-padding criteria-list-terms">\n      <li class="criteria-list-item" ng-show="terms && terms.length>10">\n        <span class="input-group input-group-sm no-padding-top">\n          <input ng-model="searchText" type="text" class="form-control" aria-describedby="term-search">\n          <span class="input-group-addon" id="term-search"><i class="glyphicon glyphicon-search"></i></span>\n        </span>\n      </li>\n      <li ng-show="terms && terms.length>10"></li>\n      <li class="criteria-list-item"\n        ng-show="isInFilter() || isContainsFilter()"\n        ng-repeat="term in terms | regex:searchText:[\'key\',\'title\',\'description\']"\n        uib-popover="{{term.description}}"\n        popover-title="{{term.title}}"\n        popover-placement="bottom"\n        popover-trigger="mouseenter">\n          <span>\n            <label class="control-label">\n              <input ng-model="checkboxTerms[term.key]"\n                type="checkbox"\n                ng-click="updateSelection()">\n              <span>{{truncate(term.title)}}</span>\n            </label>\n          </span>\n          <span class="pull-right">\n            <span class="agg-term-count" ng-show="isSelectedTerm(term)">{{term.count}}</span>\n            <span class="agg-term-count-default" ng-show="!isSelectedTerm(term)">{{term.count}}</span>\n          </span>\n      </li>\n    </ul>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/target-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/target-template.html","<span></span>")}]),angular.module("search/views/graphics/graphics-search-result-template.html",[]).run(["$templateCache",function(a){a.put("search/views/graphics/graphics-search-result-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n\n  <p class="help-block" ng-if="!loading && noResults" translate>search.no-results</p>\n\n  <div ng-repeat="chart in chartObjects" class="panel panel-default">\n    <div class="panel-heading">\n      {{chart.chartObject.options.title}}\n    </div>\n    <div class="panel-body">\n      <div class="row">\n        <div class="col-md-6">\n          <div google-chart chart="chart.chartObject" style="min-height:350px; width:100%;"></div>\n        </div>\n        <div class="col-md-6">\n          <div class="table-responsive" ng-if="chart.chartObject.data && chart.chartObject.data.length>1">\n            <table class="table table-bordered table-striped">\n              <thead>\n              <tr>\n                <th>{{chart.chartObject.data[0][0]}}</th>\n                <th>{{chart.chartObject.data[0][1]}}</th>\n                <th ng-if="chart.chartObject.data[0][2]">{{chart.chartObject.data[0][2]}}</th>\n              </tr>\n              </thead>\n              <tbody>\n              <tr ng-repeat="row in chart.chartObject.entries">\n                <td>{{row.title}}</td>\n                <td><a href ng-click="updateCriteria(row.key, chart.chartObject.vocabulary)">{{row.value}}</a></td>\n                <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n              </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/datasets-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/datasets-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th translate>acronym</th>\n          <th translate>name</th>\n          <th translate ng-if="optionsCols.showDatasetsTypeColumn">type</th>\n          <th translate ng-if="optionsCols.showDatasetsNetworkColumn">networks</th>\n          <th translate ng-if="optionsCols.showDatasetsStudiesColumn">studies</th>\n          <th translate ng-if="optionsCols.showDatasetsVariablesColumn">variables</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="6">{{options.noResultsLabel | translate}}</td>\n        </tr>\n        <tr ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang">\n          <td>\n            <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n              <localized value="summary.acronym" lang="lang"></localized>\n            </a>\n          </td>\n          <td>\n            <localized value="summary.name" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showDatasetsTypeColumn">\n            <localized value="classNames[summary.variableType + \'Dataset\']" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showDatasetsNetworkColumn">\n            <a href ng-click="updateCriteria(summary.id, \'networks\')" ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks">{{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks">-</span>\n          </td>\n          <td ng-if="optionsCols.showDatasetsStudiesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'studies\')" ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies">{{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies">-</span>\n          </td>\n          <td ng-if="optionsCols.showDatasetsVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')">{{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].variables}}</a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/networks-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/networks-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n        <tr>\n          <th rowspan="2" translate>acronym</th>\n          <th rowspan="2" translate>name</th>\n          <th rowspan="2" translate ng-if="optionsCols.showNetworksStudiesColumn">studies</th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showNetworksStudyDatasetColumn + optionsCols.showNetworksHarmonizedDatasetColumn}}"\n              ng-if="optionsCols.showNetworksStudyDatasetColumn || optionsCols.showNetworksHarmonizedDatasetColumn">\n            datasets\n          </th>\n          <th rowspan="2" translate ng-if="optionsCols.showNetworksVariablesColumn">variables</th>\n        </tr>\n        <tr>\n          <th translate ng-if="optionsCols.showNetworksStudyDatasetColumn">search.study.label</th>\n          <th translate ng-if="optionsCols.showNetworksHarmonizedDatasetColumn">search.harmonization</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="6">{{options.noResultsLabel | translate}}</td>\n        </tr>\n        <tr ng-repeat="summary in summaries">\n          <td>\n            <a ng-href="{{PageUrlService.networkPage(summary.id)}}">\n              <localized value="summary.acronym" lang="lang"></localized>\n            </a>\n          </td>\n          <td>\n            <localized value="summary.name" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showNetworksStudiesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'studies\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies">{{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksStudyDatasetColumn">\n            <a href ng-click="updateCriteria(summary.id, \'StudyDataset\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">{{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksHarmonizedDatasetColumn">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationDataset\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">{{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')">{{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables}}</a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/pagination-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/pagination-template.html",'<span class="input-group voffset1">\n  <ul class="pagination pagination-sm no-padding no-margin">\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first">\n      <a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-prev">\n      <a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a>\n    </li>\n    <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}"\n        class="pagination-page">\n      <a href ng-click="selectPage(page.number, $event)">{{page.text}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-next">\n      <a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a>\n    </li>\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last">\n      <a href ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a>\n    </li>\n  </ul>\n  <ul class="pagination no-margin pagination-sm" ng-show="1 < totalPages">\n    <li>\n      <a href ng-show="1 < totalPages" class="pagination-total">{{$parent.pagination.from}} - {{$parent.pagination.to}} {{\'of\' | translate}} {{totalItems}}</a>\n    </li>\n  </ul>\n</span>')}]),angular.module("search/views/list/search-result-pagination-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/search-result-pagination-template.html",'<span ng-show="totalHits > 10" class="form-inline">\n  <span class="input-group">\n    <select class="form-control form-select"\n            ng-model="pagination.selected"\n            ng-options="size.label for size in pageSizes"\n            ng-change="pageSizeChanged()"></select>\n  </span>\n\n  <span ng-show="maxSize > 1"\n        uib-pagination\n        total-items="totalHits"\n        max-size="maxSize"\n        ng-model="pagination.currentPage"\n        boundary-links="true"\n        force-ellipses="true"\n        items-per-page="pagination.selected.value"\n        previous-text="&lsaquo;"\n        next-text="&rsaquo;"\n        first-text="&laquo;"\n        last-text="&raquo;"\n        template-url="search/views/list/pagination-template.html"\n        ng-change="pageChanged()">\n  </span>\n</span>')}]),angular.module("search/views/list/studies-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/studies-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th rowspan="2" translate>acronym</th>\n          <th rowspan="2" translate>name</th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesDesignColumn">search.study.design</th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showStudiesQuestionnaireColumn + optionsCols.showStudiesPmColumn + optionsCols.showStudiesBioColumn + optionsCols.showStudiesOtherColumn}}"\n              ng-if="optionsCols.showStudiesQuestionnaireColumn || optionsCols.showStudiesPmColumn || optionsCols.showStudiesBioColumn || optionsCols.showStudiesOtherColumn">\n            search.study.dataSources\n          </th>\n          <th rowspan="2" translate>search.study.participants</th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesNetworksColumn">networks</th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showStudiesDatasetsColumn + optionsCols.showStudiesHarmonizedDatasetsColumn}}"\n              ng-if="optionsCols.showStudiesDatasetsColumn || optionsCols.showStudiesHarmonizedDatasetsColumn">datasets\n          </th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesVariablesColumn">variables</th>\n        </tr>\n        <tr>\n          <th translate ng-if="optionsCols.showStudiesQuestionnaireColumn">search.study.quest</th>\n          <th translate ng-if="optionsCols.showStudiesPmColumn">search.study.pm</th>\n          <th translate ng-if="optionsCols.showStudiesBioColumn">search.study.bio</th>\n          <th translate ng-if="optionsCols.showStudiesOtherColumn">search.study.others</th>\n          <th translate ng-if="optionsCols.showStudiesDatasetsColumn">search.study.label</th>\n          <th translate ng-if="optionsCols.showStudiesHarmonizedDatasetsColumn">search.harmonization</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="12">{{options.noResultsLabel | translate}}</td>\n        </tr>\n        <tr ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang">\n          <td>\n            <a ng-href="{{PageUrlService.studyPage(summary.id)}}">\n              <localized value="summary.acronym" lang="lang"></localized>\n            </a>\n          </td>\n          <td>\n            <localized value="summary.name" lang="lang"></localized>\n          </td>\n          <td>\n            <localized ng-repeat="d in summary.designs" value="designs[d]" lang="lang"></localized>\n          </td>\n          <td>\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'questionnaires\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'questionnaires\')">-</span>\n          </td>\n          <td>\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'physical_measures\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'physical_measures\')">-</span>\n          </td>\n          <td>\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'biological_samples\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'biological_samples\')">-</span>\n          </td>\n          <td>\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'others\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'others\')">-</span>\n          </td>\n          <td>\n            {{summary.targetNumber.number}}\n          </td>\n          <td ng-if="optionsCols.showStudiesNetworksColumn">\n            <a href ng-click="updateCriteria(summary.id, \'networks\')"\n                ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks">{{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesDatasetsColumn">\n            <a href ng-click="updateCriteria(summary.id, \'StudyDataset\')"\n                ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">{{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesHarmonizedDatasetsColumn">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationDataset\')"\n                ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">{{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets}}</a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')">{{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].variables}}</a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n');
}]),angular.module("search/views/list/variables-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/variables-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n        <tr>\n          <th translate>name</th>\n          <th translate>search.variable.label</th>\n          <th translate ng-if="optionsCols.showVariablesStudiesColumn">search.study.label</th>\n          <th translate ng-if="optionsCols.showVariablesDatasetsColumn">search.dataset.label</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="4">{{options.noResultsLabel | translate}}</td>\n        </tr>\n        <tr ng-repeat="summary in summaries">\n          <td>\n            <a\n              href="{{PageUrlService.VariablePage(summary.id) ? PageUrlService.VariablePage(summary.id) : PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n              {{summary.name}}\n            </a>\n          </td>\n          <td>\n            <localized value="summary.variableLabel" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showVariablesStudiesColumn">\n            <a ng-href="{{PageUrlService.studyPage(summary.studyId)}}">\n              <localized value="summary.studyAcronym" lang="lang"></localized>\n            </a>\n          </td>\n          <td ng-if="optionsCols.showVariablesDatasetsColumn">\n            <a ng-href="{{PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n              <localized value="summary.datasetAcronym" lang="lang"></localized>\n            </a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/search-result-coverage-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-coverage-template.html",'<div ng-show="display === \'coverage\'">\n  <coverage-result-table result="result.coverage" loading="loading" bucket="bucket" query="query"\n      class="voffset2" on-update-criteria="onUpdateCriteria"></coverage-result-table>\n</div>\n')}]),angular.module("search/views/search-result-graphics-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-graphics-template.html",'<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2"></graphics-result>\n</div>')}]),angular.module("search/views/search-result-list-dataset-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-dataset-template.html",'<div class="tab-pane" ng-show="options.datasets.showSearchTab" ng-class="{\'active\': activeTarget.datasets.active}">\n  <span ng-if="resultTabsOrder.length === 1">{{\'datasets\' | translate}} ({{result.list.datasetResultDto.totalHits}})</span>\n  <datasets-result-table loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.datasetResultDto[\'obiba.mica.DatasetResultDto.result\'].datasets"></datasets-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-network-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-network-template.html",'<div class="tab-pane" ng-show="options.networks.showSearchTab" ng-class="{\'active\': activeTarget.networks.active}">\n  <span ng-if="resultTabsOrder.length === 1">{{\'networks\' | translate}} ({{result.list.networkResultDto.totalHits}})</span>\n  <networks-result-table loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.networkResultDto[\'obiba.mica.NetworkResultDto.result\'].networks"></networks-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-study-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-study-template.html",'<div class="tab-pane" ng-show="options.studies.showSearchTab" ng-class="{\'active\': activeTarget.studies.active}">\n  <span ng-if="resultTabsOrder.length === 1">{{\'studies\' | translate}} ({{result.list.studyResultDto.totalHits}})</span>\n  <studies-result-table loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.studyResultDto[\'obiba.mica.StudyResultDto.result\'].summaries"></studies-result-table>\n</div>')}]),angular.module("search/views/search-result-list-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-template.html",'<div ng-show="display === \'list\'">\n  <ul class="nav nav-pills voffset2" ng-if="resultTabsOrder.length > 1">\n    <li role="presentation" ng-repeat="res in resultTabsOrder"\n        ng-class="{active: activeTarget[targetTypeMap[res]].active}"\n        ng-if="options[targetTypeMap[res]].showSearchTab"><a href\n        ng-click="selectTarget(targetTypeMap[res])">{{targetTypeMap[res] | translate}} ({{result.list[res +\n      \'ResultDto\'].totalHits}})</a></li>\n    <li ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="pull-right">\n      <span search-result-pagination\n            target="activeTarget[targetTypeMap[res]].name"\n            total-hits="activeTarget[targetTypeMap[res]].totalHits"\n            on-change="onPaginate"></span>\n    </li>\n  </ul>\n  <div class="tab-content">\n    <ng-include include-replace ng-repeat="res in resultTabsOrder"\n        src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n  </div>\n</div>\n')}]),angular.module("search/views/search-result-list-variable-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-variable-template.html",'<div class="tab-pane" ng-show="options.variables.showSearchTab" ng-class="{\'active\': activeTarget.variables.active}">\n  <span ng-if="resultTabsOrder.length === 1">{{\'variables\' | translate}} ({{result.list.variableResultDto.totalHits}})</span>\n  <variables-result-table loading="loading"\n      summaries="result.list.variableResultDto[\'obiba.mica.DatasetVariableResultDto.result\'].summaries"></variables-result-table>\n</div>\n')}]),angular.module("search/views/search-result-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-panel-template.html","<div>\n  <ng-include include-replace ng-repeat=\"tab in searchTabsOrder\"\n    src=\"'search/views/search-result-' + tab + '-template.html'\"></ng-include>\n</div>\n")}]),angular.module("search/views/search.html",[]).run(["$templateCache",function(a){a.put("search/views/search.html",'<div>\n  <div ng-if="searchHeaderTemplateUrl" ng-include="searchHeaderTemplateUrl"></div>\n\n  <obiba-alert id="SearchController"></obiba-alert>\n\n  <!-- Lang tabs -->\n  <ul class="nav nav-tabs" role="tablist" ng-if="tabs && tabs.length>1">\n    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab"\n      ng-click="setLocale(tab)">{{\'language.\' + tab | translate}}</a></li>\n  </ul>\n\n  <!-- Search box region -->\n  <div class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n    <div class="row">\n      <div class="col-md-3"></div>\n      <div class="col-md-6">\n        <script type="text/ng-template" id="customTemplate.html">\n          <a ng-if="match.model.id">\n            <table style="border:none;">\n              <tbody>\n              <tr>\n                <td style="min-width: 30px;">\n                  <span title="{{match.model.target + \'-classifications\' | translate}}">\n                    <i class="{{\'i-obiba-large i-obiba-\' + match.model.target}}"></i>\n                  </span>\n                </td>\n                <td>\n                  <span\n                    uib-popover-html="match.model.itemDescription | uibTypeaheadHighlight:query"\n                    popover-title="{{match.model.itemTitle}}"\n                    popover-placement="bottom"\n                    popover-trigger="mouseenter"\n                    ng-bind-html="match.model.itemTitle | uibTypeaheadHighlight:query">\n                  </span>\n                  <small class="help-block no-margin" title="{{match.model.itemParentDescription}}">\n                    {{match.model.itemParentTitle}}\n                  </small>\n                </td>\n              </tr>\n              </tbody>\n            </table>\n          </a>\n          <a ng-if="!match.model.id" class="{{match.model.status}}">\n            <small class="help-block no-margin">\n              {{match.model.message}}\n            </small>\n          </a>\n        </script>\n          <span class="input-group input-group-sm">\n            <span class="input-group-btn" uib-dropdown>\n              <button type="button" class="btn btn-primary" uib-dropdown-toggle>\n                {{\'taxonomy.target.\' + (documents.search.target ? documents.search.target : \'all\')| translate}} <span\n                class="caret"></span>\n              </button>\n              <ul uib-dropdown-menu role="menu">\n                <li>\n                  <a href ng-click="selectSearchTarget()" translate>taxonomy.target.all</a>\n                </li>\n                <li ng-repeat="target in targets" role="menuitem"><a href ng-click="selectSearchTarget(target)">{{\'taxonomy.target.\'\n                  + target | translate}}</a></li>\n              </ul>\n            </span>\n            <input type="text" ng-model="selectedCriteria"\n              placeholder="{{\'search.placeholder.\' + (documents.search.target ? documents.search.target : \'all\') | translate}}"\n              uib-typeahead="criteria for criteria in searchCriteria($viewValue)"\n              typeahead-min-length="2"\n              typeahead-loading="documents.search.active"\n              typeahead-template-url="customTemplate.html"\n              typeahead-on-select="selectCriteria($item)"\n              class="form-control">\n            <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n          </span>\n      </div>\n    </div>\n    <div class="row">\n      <div class="col-md-3"></div>\n      <div class="col-md-6">\n        <small>\n          <ul class="nav nav-pills">\n            <li ng-repeat="t in taxonomyNav track by $index" title="{{t.locale.description.text}}">\n              <a href ng-click="showTaxonomy(t.target, t.name)" ng-if="!t.terms">{{t.locale.title.text}}</a>\n            <span uib-dropdown ng-if="t.terms">\n              <ul class="nav nav-pills">\n                <li>\n                  <a href uib-dropdown-toggle>{{t.locale.title.text}} <span class="caret"></span></a>\n                </li>\n              </ul>\n              <ul uib-dropdown-menu>\n                <li ng-repeat="st in t.terms">\n                  <a href ng-click="showTaxonomy(t.target, st.name)" title="{{st.locale.description.text}}">{{st.locale.title.text}}</a>\n                </li>\n              </ul>\n            </span>\n            </li>\n            <li>\n              <a href ng-click="goToClassifications()" title="{{\'search.classifications-show\' | translate}}">\n                <i class="glyphicon glyphicon-option-horizontal"></i>\n              </a>\n            </li>\n          </ul>\n        </small>\n      </div>\n    </div>\n    <taxonomies-panel taxonomy-name="taxonomyName" target="target" on-select-term="onSelectTerm"\n      on-close="clearTaxonomy" lang="lang" taxonomies-shown="taxonomiesShown"></taxonomies-panel>\n  </div>\n\n  <!-- Search criteria region -->\n  <div class="panel panel-default voffset2" ng-if="search.criteria.children && search.criteria.children.length>0">\n    <div class="panel-body">\n      <table style="border:none;">\n        <tbody>\n        <tr>\n          <td>\n            <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n          </td>\n          <td>\n            <div criteria-root item="search.criteria" query="search.query" on-remove="removeCriteriaItem"\n              on-refresh="refreshQuery"></div>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n  <!-- Results region -->\n  <div class="voffset3" ng-if="search.query">\n\n    <ul class="nav nav-tabs voffset2" ng-if="searchTabsOrder.length > 1">\n      <li role="presentation" ng-repeat="tab in searchTabsOrder" ng-class="{active: search.display === tab}"><a href\n        ng-click="selectDisplay(tab)">{{ options[ tab + \'Label\'] | translate}}</a></li>\n    </ul>\n    <div class="tab-panel">\n      <result-panel display="search.display"\n        type="search.type"\n        bucket="search.bucket"\n        query="search.executedQuery"\n        result="search.result"\n        loading="search.loading"\n        on-update-criteria="onUpdateCriteria"\n        on-type-changed="onTypeChanged"\n        on-bucket-changed="onBucketChanged"\n        on-paginate="onPaginate"\n        search-tabs-order="searchTabsOrder"\n        result-tabs-order="resultTabsOrder"\n        lang="lang"></result-panel>\n    </div>\n  </div>\n</div>')}]);