<!--
  ~ Copyright (c) 2018 OBiBa. All rights reserved.
  ~
  ~ This program and the accompanying materials
  ~ are made available under the terms of the GNU Public License v3.0.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div>

  <h2>
    <ol class="breadcrumb mica-breadcrumb">
      <li><a href="#/admin" translate>global.menu.admin</a></li>
      <li class="active" translate>general</li>
    </ol>
  </h2>

  <h3 translate>properties</h3>

  <div class="row">
    <div class="col-md-6">

      <h4 ng-class="{'no-margin-top': screen.is('lg')}" translate>config.serverIdentification</h4>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.name</span>
            <span class="help-block" translate>config.name-help</span>
          </td>
          <td>{{micaConfig.name}}</td>
        </tr>
        <tr>
          <td>
            <span translate>config.publicUrl</span>
            <span class="help-block" translate>config.publicUrl-help</span>
          </td>
          <td>{{micaConfig.publicUrl}}</td>
        </tr>
        <tr>
          <td>
            <span translate>config.portalUrl</span>
            <span class="help-block" translate>config.portalUrl-help</span>
          </td>
          <td>{{micaConfig.portalUrl}}</td>
        </tr>
        <tr>
          <td>
            <span translate>config.usePublicUrlForSharedLink</span>
            <span class="help-block" translate>config.usePublicUrlForSharedLink-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isUsePublicUrlForSharedLink"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isUsePublicUrlForSharedLink"></i>
          </td>
        </tr>
        </tbody>
      </table>




    </div>
    <div class="col-md-6">
      <h4 ng-class="{'no-margin-top': screen.is('lg')}" translate>config.dataSource</h4>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.opal</span>
            <span class="help-block" translate>config.opal-help</span>
          </td>
          <td><a ng-href="{{micaConfig.opal}}" target="_blank">{{micaConfig.opal}}</a></td>
        </tr>
        <tr>
          <td>
            <span translate>config.privacy-threshold</span>
            <span class="help-block" translate>config.privacy-threshold-help</span>
          </td>
          <td>{{micaConfig.privacyThreshold}}</td>
        </tr>
        </tbody>
      </table>

    </div>
  </div>

  <h4 translate>config.content</h4>

  <div class="row">
    <div class="col-md-6">
      <h5 translate>config.content-edition</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.languages</span>
            <span class="help-block" translate>config.languages-help</span>
          </td>
          <td>
            <ul class="list-inline">
              <li ng-repeat="lang in micaConfig.languages">
                <span class="badge">{{lang}}</span> {{availableLanguages[lang]}}
              </li>
            </ul>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.defaultCharSet</span>
          </td>
          <td>{{micaConfig.defaultCharSet}}</td>
        </tr>
        </tbody>
      </table>

      <h5 translate class="voffset4">config.content-access</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.openAccess</span>
            <span class="help-block" translate>config.openAccess-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.openAccess"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.openAccess"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.variableSummaryRequiresAuthentication</span>
            <span class="help-block" translate>config.variableSummaryRequiresAuthentication-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.variableSummaryRequiresAuthentication"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.variableSummaryRequiresAuthentication"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.signup-enabled</span>
            <span class="help-block" translate>config.signup-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.signupEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.signupEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.signup-with-password</span>
            <span class="help-block" translate>config.signup-with-password-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.signupWithPassword"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.signupWithPassword"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.signup-groups</span>
            <span class="help-block" translate>config.signup-groups-help</span>
          </td>
          <td>
            <ul class="list-inline">
              <li ng-repeat="group in micaConfig.signupGroups">
                <span class="badge">{{group}}</span>
              </li>
            </ul>
          </td>
        </tr>
        </tbody>
      </table>

      <h5 translate>config.sets</h5>

      <table class="table table-bordered table-striped">
        <tbody>

        <tr>
          <td>
            <span translate>config.cart-enabled</span>
            <span class="help-block" translate>config.cart-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isCartEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isCartEnabled"></i>
          </td>
        </tr>

        <tr>
          <td>
            <span translate>config.anonymous-create-cart</span>
            <span class="help-block" translate>config.anonymous-create-cart-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.anonymousCanCreateCart"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.anonymousCanCreateCart"></i>
          </td>
        </tr>

        <tr>
          <td>
            <span translate>config.sets-search-enabled</span>
            <span class="help-block" translate>config.sets-search-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isSetsSearchEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isSetsSearchEnabled"></i>
          </td>
        </tr>

        <tr>
          <td>
            <span translate>config.max-number-sets</span>
            <span class="help-block" translate>config.max-number-sets-help</span>
          </td>
          <td>{{micaConfig.maxNumberOfSets}}</td>
        </tr>

        <tr>
          <td>
            <span translate>config.max-items-per-set</span>
            <span class="help-block" translate>config.max-items-per-set-help</span>
          </td>
          <td>{{micaConfig.maxItemsPerSet}}</td>
        </tr>

        <tr>
          <td>
            <span translate>config.cart-time-to-live</span>
            <span class="help-block" translate>config.cart-time-to-live-help</span>
          </td>
          <td>{{micaConfig.cartTimeToLive}}</td>
        </tr>

        <tr>
          <td>
            <span translate>config.set-time-to-live</span>
            <span class="help-block" translate>config.set-time-to-live-help</span>
          </td>
          <td>{{micaConfig.setTimeToLive}}</td>
        </tr>

        <tr>
          <td>
            <span translate>config.opal-views-grouping</span>
            <span class="help-block">{{'config.opal-views-grouping-' + micaConfig.opalViewsGrouping + '-help' | translate}}</span>
          </td>
          <td>{{'config.opal-views-grouping-label.' + micaConfig.opalViewsGrouping | translate}}</td>
        </tr>

        </tbody>
      </table>

    </div>

    <div class="col-md-6">
      <h5 translate>config.sections</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.repository-enabled</span>
            <span class="help-block" translate>config.repository-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isRepositoryEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isRepositoryEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.single-study-enabled</span>
            <span class="help-block" translate>config.single-study-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isSingleStudyEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isSingleStudyEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.network-enabled</span>
            <span class="help-block" translate>config.network-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isNetworkEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isNetworkEnabled"></i>
          </td>
        </tr>
        <tr ng-class="{'text-muted': !micaConfig.isNetworkEnabled}">
          <td>
            <span translate>config.single-network-enabled</span>
            <span class="help-block" translate>config.single-network-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isSingleNetworkEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isSingleNetworkEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.collected-dataset-enabled</span>
            <span class="help-block" translate>config.collected-dataset-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isCollectedDatasetEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isCollectedDatasetEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.harmonized-dataset-enabled</span>
            <span class="help-block" translate>config.harmonized-dataset-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isHarmonizedDatasetEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isHarmonizedDatasetEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.project-enabled</span>
            <span class="help-block" translate>config.project-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isProjectEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isProjectEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.data-access-enabled</span>
            <span class="help-block" translate>config.data-access-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isDataAccessEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isDataAccessEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.import-studies-feature-enabled</span>
            <span class="help-block" translate>config.import-studies-feature-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isImportStudiesFeatureEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isImportStudiesFeatureEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.comments-required</span>
            <span class="help-block" translate>config.comments-required-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isCommentsRequiredOnDocumentSave"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isCommentsRequiredOnDocumentSave"></i>
          </td>
        </tr>
        </tbody>
      </table>

      <h5 translate>config.data-analyses.title</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.contingency-enabled</span>
            <span class="help-block" translate>config.contingency-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isContingencyEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isContingencyEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.sets-analysis-enabled</span>
            <span class="help-block" translate>config.sets-analysis-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isSetsAnalysisEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isSetsAnalysisEnabled"></i>
          </td>
        </tr>
        </tbody>
      </table>


      <h5 translate>config.searchLayout.title</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.searchLayout.title</span>
            <span class="help-block" translate>config.searchLayout.help</span>
          </td>
          <td>
            {{'config.searchLayout.' + micaConfig.searchLayout | translate}}
          </td>
        </tr>
        </tbody>
      </table>

      <h5 translate>entity-statistics-summary.full-title</h5>
      <table class="table table-bordered table-striped">
        <tbody>
        <tr>
          <td>
            <span translate>config.variables-count-enabled</span>
            <span class="help-block" translate>config.variables-count-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isVariablesCountEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isVariablesCountEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.projects-count-enabled</span>
            <span class="help-block" translate>config.projects-count-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isProjectsCountEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isProjectsCountEnabled"></i>
          </td>
        </tr>
        <tr>
          <td>
            <span translate>config.data-access-requests-count-enabled</span>
            <span class="help-block" translate>config.data-access-requests-count-enabled-help</span>
          </td>
          <td>
            <i class="fa fa-check-square-o" ng-hide="!micaConfig.isDataAccessRequestsCountEnabled"></i>
            <i class="fa fa-square-o" ng-hide="micaConfig.isDataAccessRequestsCountEnabled"></i>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <a href="#/admin/general/edit" class="btn btn-primary">
        <i class="fa fa-pencil-square-o"></i> <span translate>edit</span>
      </a>
    </div>
  </div>
  <div class="row">

    <div class="col-md-6">
      <h3 translate>config.encryption-keys</h3>
      <p class="help-block" translate>
        config.encryption-keys-help
      </p>

      <div class="btn-group dropdown" is-open="status.isopen">
        <button type="button" class="btn btn-info dropdown-toggle" ng-disabled="disabled" data-toggle="dropdown">
          <i class="fa fa-plus"></i> <span translate>config.addKeyPair</span> <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><a role="menuitem" href="" ng-click="createKeyPair()" translate>config.create</a></li>
          <li><a role="menuitem" href="" ng-click="importKeyPair()" translate>config.import</a></li>
        </ul>
      </div>

      <a href="" class="btn btn-default" ng-click="downloadCertificate()">
        <i class="fa fa-download"></i> <span translate>config.download-certificate</span>
      </a>

      <h3 translate>config.opal-credentials</h3>
      <p class="help-block" translate>
        config.opal-credentials-help
      </p>

      <div class="btn-group dropdown" is-open="status.isopen">
        <button type="button" class="btn btn-info dropdown-toggle" ng-disabled="disabled" data-toggle="dropdown">
          <i class="fa fa-plus"></i> <span translate>config.opal-credential-add</span> <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><a href="" ng-click="createOpalCredentialKeyPair()" translate>config.create</a></li>
          <li><a href="" ng-click="importOpalCredentialKeyPair()" translate>config.import</a></li>
          <li><a href="" ng-click="addOpalCredentialUserPass()" translate>config.username</a></li>
          <li><a href="" ng-click="addOpalCredentialToken()" translate>config.opalToken</a></li>
        </ul>
      </div>

      <div class="row" ng-show="opalCredentials.length">
        <div class="col-md-12">
          <table class="table table-bordered table-striped">
            <thead>
            <tr>
              <th translate>config.opalUrl</th>
              <th translate>config.type</th>
              <th translate>config.actions</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="opalCredential in opalCredentials">
              <td><a href="{{opalCredential.opalUrl}}" target="_blank">{{opalCredential.opalUrl}}</a></td>
              <td>{{'config.opal-credential-type.' + opalCredential.type | translate}}</td>
              <td>
                <ul class="list-inline">
                  <li>
                    <a ng-click="deleteOpalCredential(opalCredential)" class="hand action" title="{{'delete' | translate}}"><i class="fa fa-trash-o"></i></a>
                  </li>
                  <li ng-if="opalCredential.type === 'USERNAME' || opalCredential.type === 'TOKEN'">
                    <a ng-click="editOpalCredentialCertificate(opalCredential)" class="hand action" title="{{'edit' | translate}}"><i class="fa fa-edit"></i></a>
                  </li>
                  <li ng-if="opalCredential.type === 'PUBLIC_KEY_CERTIFICATE'">
                    <a ng-click="downloadOpalCredentialCertificate(opalCredential)" class="hand action" title="{{'config.download-certificate' | translate}}"><i class="fa fa-download"></i></a>
                  </li>
                </ul>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <div class="col-md-6">
      <h3 translate>config.roles</h3>
      <p class="help-block" translate>
        config.roles-help
      </p>
      <button type="button" class="btn btn-info voffset2" ng-click="addRole()">
        <i class="fa fa-plus"></i> <span translate>config.add-role</span>
      </button>

      <div ng-show="micaConfig.roles && micaConfig.roles.length > 0">
        <div class="voffset3">
          <table class="table table-bordered table-striped attributes-column">
            <thead>
            <tr>
              <th class="width75" translate>id</th>
              <th translate>actions</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="role in micaConfig.roles">
              <td class="width75">
                {{role}}
              </td>
              <td>
                <a href="" ng-click="deleteRole($index)" class="action"><i class="fa fa-trash-o"></i></a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <h3 translate>permissions</h3>

      <h4 translate>config.opal-sets-views-download-permission-title</h4>

      <div class="help-block">{{'config.opal-sets-views-download-permission-help' | translate}}</div>

      <permission-config-table
        overridden-role-help-texts="documentSetsRoleHelpTexts"
        name="'opal-views'"
        allow-blocked-principals="true"
        permissions="documentSetsAcls"
        roles="documentSetsRoles"
        on-add="onAddDocumentSetsAcl"
        on-delete="onRemoveDocumentSetsAcl"
        on-load="onLoadDocumentSetsAcls">
      </permission-config-table>

      <h4 translate>config.crosstabs-permission-title</h4>

      <div class="help-block">{{'config.crosstabs-permission-help' | translate}}</div>

      <permission-config-table
        overridden-role-help-texts="crosstabsRoleHelpTexts"
        name="'crosstabs'"
        allow-blocked-principals="true"
        permissions="crosstabsAcls"
        roles="crosstabsRoles"
        on-add="onAddCrosstabsAcl"
        on-delete="onRemoveCrosstabsAcl"
        on-load="onLoadCrosstabsAcls">
      </permission-config-table>

    </div>
  </div>


</div>
